// swim-client-3.10.2; copyright 2015-2020 SWIM.AI inc.
!function(t,e){"object"==typeof exports&&"undefined"!=typeof module?e(exports,require("@swim/collections"),require("@swim/uri"),require("@swim/structure"),require("@swim/warp"),require("@swim/util"),require("@swim/streamlet"),require("@swim/dataflow")):"function"==typeof define&&define.amd?define(["exports","@swim/collections","@swim/uri","@swim/structure","@swim/warp","@swim/util","@swim/streamlet","@swim/dataflow"],e):e((t=t||self).swim=t.swim||{},t.swim,t.swim,t.swim,t.swim,t.swim,t.swim,t.swim)}(this,(function(t,e,i,o,n,r,s,h){"use strict";var l=function(){},u=function(t,e){return(u=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)e.hasOwnProperty(i)&&(t[i]=e[i])})(t,e)};
/*! *****************************************************************************
    Copyright (c) Microsoft Corporation. All rights reserved.
    Licensed under the Apache License, Version 2.0 (the "License"); you may not use
    this file except in compliance with the License. You may obtain a copy of the
    License at http://www.apache.org/licenses/LICENSE-2.0

    THIS CODE IS PROVIDED ON AN *AS IS* BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY
    KIND, EITHER EXPRESS OR IMPLIED, INCLUDING WITHOUT LIMITATION ANY IMPLIED
    WARRANTIES OR CONDITIONS OF TITLE, FITNESS FOR A PARTICULAR PURPOSE,
    MERCHANTABLITY OR NON-INFRINGEMENT.

    See the Apache Version 2.0 License for specific language governing permissions
    and limitations under the License.
    ***************************************************************************** */function a(t,e){function i(){this.constructor=t}u(t,e),t.prototype=null===e?Object.create(e):(i.prototype=e.prototype,new i)}function p(t,e,i,o){var n,r=arguments.length,s=r<3?e:null===o?o=Object.getOwnPropertyDescriptor(e,i):o;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)s=Reflect.decorate(t,e,i,o);else for(var h=t.length-1;h>=0;h--)(n=t[h])&&(s=(r<3?n(s):r>3?n(e,i,s):n(e,i))||s);return r>3&&s&&Object.defineProperty(e,i,s),s}function c(){for(var t=0,e=0,i=arguments.length;e<i;e++)t+=arguments[e].length;var o=Array(t),n=0;for(e=0;e<i;e++)for(var r=arguments[e],s=0,h=r.length;s<h;s++,n++)o[n]=r[s];return o}var d,f=function(t){function r(n,r,s){void 0===s&&(s={});var h=t.call(this)||this;return h._context=n,h._hostUri=r,h._options=s,h._downlinks=new e.BTree,h._downlinkCount=0,h._authenticated=!1,h._session=o.Value.absent(),h._uriCache=new i.UriCache(r),h._sendBuffer=[],h._reconnectTimer=0,h._reconnectTimeout=0,h._idleTimer=0,h}return a(r,t),r.prototype.hostUri=function(){return this._hostUri},r.prototype.credentials=function(){return this._options.credentials||o.Value.absent()},r.prototype.unlinkDelay=function(){var t=this._options.unlinkDelay;return"number"==typeof t?t:0},r.prototype.maxReconnectTimeout=function(){return this._options.maxReconnectTimeout||3e4},r.prototype.idleTimeout=function(){return this._options.idleTimeout||1e3},r.prototype.sendBufferSize=function(){return this._options.sendBufferSize||1024},r.prototype.isAuthenticated=function(){return this._authenticated},r.prototype.session=function(){return this._session},r.prototype.isIdle=function(){return!this._sendBuffer.length&&!this._downlinkCount},r.prototype.resolve=function(t){return this._uriCache.resolve(t)},r.prototype.unresolve=function(t){return this._uriCache.unresolve(t)},r.prototype.authenticate=function(t){if(!(t=o.Value.fromAny(t)).equals(this._options.credentials))if(this._options.credentials=t,this.isConnected()){var e=n.AuthRequest.of(t);this.push(e)}else this.open()},r.prototype.openDownlink=function(t){this.clearIdle();var i=this.resolve(t.nodeUri()),o=t.laneUri();this._downlinkCount||this.open();var n=this._downlinks.get(i);if(n||(n=new e.BTree,this._downlinks.set(i,n)),n.get(o))throw new Error("duplicate downlink");n.set(o,t),this._downlinkCount+=1,t.openUp(this),this.isConnected()&&t.hostDidConnect(this)},r.prototype.unlinkDownlink=function(t){var e=this.resolve(t.nodeUri()),i=t.laneUri(),o=this._downlinks.get(e);if(o&&o.get(i)&&this.isConnected()){var r=n.UnlinkRequest.of(this.unresolve(e),i);t.onUnlinkRequest(r,this),this.push(r)}},r.prototype.closeDownlink=function(t){var e=this.resolve(t.nodeUri()),i=t.laneUri(),o=this._downlinks.get(e);o&&o.get(i)&&(this._downlinkCount-=1,o.delete(i),o.isEmpty()&&this._downlinks.delete(e),this._downlinkCount||this.watchIdle(),t.closeUp(this))},r.prototype.command=function(t,e,r){t=i.Uri.fromAny(t),t=this.resolve(t),e=i.Uri.fromAny(e),r=o.Value.fromAny(r);var s=n.CommandMessage.of(this.unresolve(t),e,r);this.push(s)},r.prototype.onEnvelope=function(t){t instanceof n.EventMessage?this.onEventMessage(t):t instanceof n.CommandMessage?this.onCommandMessage(t):t instanceof n.LinkRequest?this.onLinkRequest(t):t instanceof n.LinkedResponse?this.onLinkedResponse(t):t instanceof n.SyncRequest?this.onSyncRequest(t):t instanceof n.SyncedResponse?this.onSyncedResponse(t):t instanceof n.UnlinkRequest?this.onUnlinkRequest(t):t instanceof n.UnlinkedResponse?this.onUnlinkedResponse(t):t instanceof n.AuthRequest?this.onAuthRequest(t):t instanceof n.AuthedResponse?this.onAuthedResponse(t):t instanceof n.DeauthRequest?this.onDeauthRequest(t):t instanceof n.DeauthedResponse?this.onDeauthedResponse(t):this.onUnknownEnvelope(t)},r.prototype.onEventMessage=function(t){var e=this.resolve(t.node()),i=t.lane(),o=this._downlinks.get(e);if(o){var n=o.get(i);if(n){var r=t.node(e);n.onEventMessage(r,this)}}},r.prototype.onCommandMessage=function(t){},r.prototype.onLinkRequest=function(t){},r.prototype.onLinkedResponse=function(t){var e=this.resolve(t.node()),i=t.lane(),o=this._downlinks.get(e);if(o){var n=o.get(i);if(n){var r=t.node(e);n.onLinkedResponse(r,this)}}},r.prototype.onSyncRequest=function(t){},r.prototype.onSyncedResponse=function(t){var e=this.resolve(t.node()),i=t.lane(),o=this._downlinks.get(e);if(o){var n=o.get(i);if(n){var r=t.node(e);n.onSyncedResponse(r,this)}}},r.prototype.onUnlinkRequest=function(t){},r.prototype.onUnlinkedResponse=function(t){var e=this.resolve(t.node()),i=t.lane(),o=this._downlinks.get(e);if(o){var n=o.get(i);if(n){var r=t.node(e);n.onUnlinkedResponse(r,this)}}},r.prototype.onAuthRequest=function(t){},r.prototype.onAuthedResponse=function(t){this._authenticated=!0,this._session=t.body(),this._context.hostDidAuthenticate(t.body(),this)},r.prototype.onDeauthRequest=function(t){},r.prototype.onDeauthedResponse=function(t){this._authenticated=!1,this._session=o.Value.absent(),this._context.hostDidDeauthenticate(t.body(),this)},r.prototype.onUnknownEnvelope=function(t){},r.prototype.onConnect=function(){this._reconnectTimeout=0,this._context.hostDidConnect(this),this._downlinks.forEach((function(t,e){e.forEach((function(t,e){e.hostDidConnect(this)}),this)}),this)},r.prototype.onDisconnect=function(){this._authenticated=!1,this._session=o.Value.absent(),this._context.hostDidDisconnect(this),this._downlinks.forEach((function(t,e){e.forEach((function(t,e){e.hostDidDisconnect(this)}),this)}),this)},r.prototype.onError=function(t){this._context.hostDidFail(t,this),this._downlinks.forEach((function(e,i){i.forEach((function(e,i){i.hostDidFail(t,this)}),this)}),this)},r.prototype.reconnect=function(){this._reconnectTimer||(this._reconnectTimeout?this._reconnectTimeout=Math.min(Math.floor(1.8*this._reconnectTimeout),this.maxReconnectTimeout()):this._reconnectTimeout=Math.floor(500+1e3*Math.random()),this._reconnectTimer=setTimeout(this.open.bind(this),this._reconnectTimeout))},r.prototype.clearReconnect=function(){this._reconnectTimer&&(clearTimeout(this._reconnectTimer),this._reconnectTimer=0)},r.prototype.watchIdle=function(){!this._idleTimer&&this.isConnected()&&this.isIdle()&&(this._idleTimer=setTimeout(this.checkIdle.bind(this),this.idleTimeout()))},r.prototype.clearIdle=function(){this._idleTimer&&(clearTimeout(this._idleTimer),this._idleTimer=0)},r.prototype.checkIdle=function(){this.isConnected()&&this.isIdle()&&this.close()},r.prototype.close=function(){this._context.closeHost(this)},r.prototype.closeUp=function(){this._downlinks.forEach((function(t,e){e.forEach((function(t,e){e.closeUp(this)}),this)}),this)},r}(l),v=function(t){function e(e,i,o){return void 0===o&&(o={}),t.call(this,e,i,o)||this}return a(e,t),Object.defineProperty(e.prototype,"WebSocket",{get:function(){return this._options.WebSocket||"undefined"!=typeof WebSocket&&WebSocket||"function"==typeof require&&require("ws")||void 0},enumerable:!0,configurable:!0}),e.prototype.isConnected=function(){return!!this._socket&&this._socket.readyState===this._socket.OPEN},e.prototype.open=function(){if(this.clearReconnect(),!this._socket){var t=this.WebSocket;if(!t)throw new Error("WebSocket undefined");var e=this._hostUri,i=e.schemeName();"warp"===i||"swim"===i?e=e.scheme("ws"):"warps"!==i&&"swims"!==i||(e=e.scheme("wss")),this._options.protocols?this._socket=new t(e.toString(),this._options.protocols):this._socket=new t(e.toString()),this._socket.onopen=this.onWebSocketOpen.bind(this),this._socket.onmessage=this.onWebSocketMessage.bind(this),this._socket.onclose=this.onWebSocketClose.bind(this),this._socket.onerror=this.onWebSocketError.bind(this)}},e.prototype.close=function(){this.clearReconnect(),this.clearIdle(),this._socket?(this._socket.close(),this._context.isOnline()||this.onWebSocketClose()):t.prototype.close.call(this)},e.prototype.push=function(t){if(this.isConnected()){this.clearIdle();var e=t.toRecon();this._socket.send(e),this.watchIdle()}else if(t instanceof n.CommandMessage){if(!(this._sendBuffer.length<this.sendBufferSize()))throw new Error("send buffer overflow");this._sendBuffer.push(t),this.open()}},e.prototype.onWebSocketOpen=function(){if(this.isConnected()){var t=this.credentials();if(t.isDefined()){var e=new n.AuthRequest(t);this.push(e)}this.onConnect();for(var i=void 0;(i=this._sendBuffer.shift())&&this.isConnected();)this.push(i);this.watchIdle()}else this.close()},e.prototype.onWebSocketMessage=function(t){var e=t.data;if("string"==typeof e){var i=n.Envelope.parseRecon(e);i?this.onEnvelope(i):this.onUnknownEnvelope(e)}},e.prototype.onWebSocketClose=function(){this._socket&&(this._socket.onopen=null,this._socket.onmessage=null,this._socket.onclose=null,this._socket.onerror=null,this._socket=void 0),this.onDisconnect(),this.clearIdle(),this.isIdle()?this.close():this._context.isOnline()&&this.reconnect()},e.prototype.onWebSocketError=function(){this._socket&&(this._socket.close(),this._context.isOnline()?this.onError():this.onWebSocketClose())},e}(f),_=function(){function t(t,e,i,n,r,s,h){void 0===r&&(r=0),void 0===s&&(s=0),void 0===h&&(h=o.Value.absent()),this._context=t,this._hostUri=e,this._nodeUri=i,this._laneUri=n,this._prio=r,this._rate=s,this._body=h,this._views=[],this._host=null,this._status=0}return t.prototype.hostUri=function(){return this._hostUri},t.prototype.nodeUri=function(){return this._nodeUri},t.prototype.laneUri=function(){return this._laneUri},t.prototype.prio=function(){return this._prio},t.prototype.rate=function(){return this._rate},t.prototype.body=function(){return this._body},t.prototype.keepLinked=function(){for(var t=0;t<this._views.length;t+=1)if(this._views[t].keepLinked())return!0;return!1},t.prototype.keepSynced=function(){for(var t=0;t<this._views.length;t+=1)if(this._views[t].keepSynced())return!0;return!1},t.prototype.unlinkDelay=function(){return this._host?this._host.unlinkDelay():0},t.prototype.isConnected=function(){return!(!this._host||!this._host.isConnected())},t.prototype.isAuthenticated=function(){return!(!this._host||!this._host.isAuthenticated())},t.prototype.isLinked=function(){return 0!=(2&this._status)},t.prototype.isSynced=function(){return 0!=(8&this._status)},t.prototype.session=function(){return this._host?this._host.session():o.Value.absent()},t.prototype.addDownlink=function(t){this._views.push(t)},t.prototype.removeDownlink=function(t){for(var e=0;e<this._views.length;e+=1)this._views[e]===t&&(this._views.splice(e,1),t.closeUp());if(0===this._views.length){var i=this.unlinkDelay();i<0?this.unlink():setTimeout(this.doUnlink.bind(this),i)}},t.prototype.onEventMessage=function(t,e){for(var i=0;i<this._views.length;i+=1)this._views[i].onEventMessage(t)},t.prototype.onCommandMessage=function(t){for(var e=0;e<this._views.length;e+=1)this._views[e].onCommandMessage(t)},t.prototype.onLinkRequest=function(t){this._status|=1;for(var e=0;e<this._views.length;e+=1)this._views[e].onLinkRequest(t)},t.prototype.onLinkedResponse=function(t,e){this._status=-2&this._status|2;for(var i=0;i<this._views.length;i+=1)this._views[i].onLinkedResponse(t)},t.prototype.onSyncRequest=function(t){this._status|=4;for(var e=0;e<this._views.length;e+=1)this._views[e].onSyncRequest(t)},t.prototype.onSyncedResponse=function(t,e){this._status=-5&this._status|8;for(var i=0;i<this._views.length;i+=1)this._views[i].onSyncedResponse(t)},t.prototype.onUnlinkRequest=function(t,e){this._status=-6&this._status|16;for(var i=0;i<this._views.length;i+=1)this._views[i].onUnlinkRequest(t)},t.prototype.onUnlinkedResponse=function(t,e){if(this._status&=-17,0===this._views.length||0!==this._status){for(var i=0;i<this._views.length;i+=1)this._views[i].onUnlinkedResponse(t);this.close()}else this.keepSynced()?this.sync():this.link()},t.prototype.hostDidConnect=function(t){for(var e=0;e<this._views.length;e+=1)this._views[e].hostDidConnect();this.keepSynced()?this.sync():this.link()},t.prototype.hostDidDisconnect=function(t){this._status=0;for(var e=!1,i=0;i<this._views.length;i+=1){var o=this._views[i];o.hostDidDisconnect(),e=e||o.keepLinked()}e||this.close()},t.prototype.hostDidFail=function(t,e){for(var i=0;i<this._views.length;i+=1)this._views[i].hostDidFail(t)},t.prototype.command=function(t){t=o.Value.fromAny(t),this.onCommandMessage(t),this._host.command(this._nodeUri,this._laneUri,t)},t.prototype.sync=function(){var t=this._host.unresolve(this._nodeUri),e=n.SyncRequest.of(t,this._laneUri,this._prio,this._rate,this._body);this.onSyncRequest(e),this._host.push(e)},t.prototype.link=function(){var t=this._host.unresolve(this._nodeUri),e=n.LinkRequest.of(t,this._laneUri,this._prio,this._rate,this._body);this.onLinkRequest(e),this._host.push(e)},t.prototype.unlink=function(){this._status=16,this._context.unlinkDownlink(this)},t.prototype.doUnlink=function(){0===this._views.length&&this.unlink()},t.prototype.close=function(){this._context.closeDownlink(this)},t.prototype.openUp=function(t){this._host=t;for(var e=0;e<this._views.length;e+=1)this._views[e].openUp(t)},t.prototype.closeUp=function(){var t=this._views;this._views=[];for(var e=0;e<t.length;e+=1)t[e].closeUp()},t}();(d=t.DownlinkFlags||(t.DownlinkFlags={}))[d.KeepLinked=1]="KeepLinked",d[d.KeepSynced=2]="KeepSynced",d[d.KeepLinkedSynced=3]="KeepLinkedSynced";var y=function(){function t(t,e,n,r,s,h,l,u,a,p,c){var d;void 0===r&&(r=i.Uri.empty()),void 0===s&&(s=i.Uri.empty()),void 0===h&&(h=i.Uri.empty()),void 0===l&&(l=0),void 0===u&&(u=0),void 0===a&&(a=o.Value.absent()),void 0===p&&(p=0),void 0===c&&(c=null),c?Array.isArray(c)||(c=[d=c]):c=[],n&&(d=d||{},c=c?c.concat(d):[d],r=void 0!==n.hostUri?i.Uri.fromAny(n.hostUri):r,s=void 0!==n.nodeUri?i.Uri.fromAny(n.nodeUri):s,h=void 0!==n.laneUri?i.Uri.fromAny(n.laneUri):h,l=void 0!==n.prio?n.prio:l,u=void 0!==n.rate?n.rate:u,a=void 0!==n.body?o.Value.fromAny(n.body):a,d.onEvent=n.onEvent||d.onEvent,d.onCommand=n.onCommand||d.onCommand,d.willLink=n.willLink||d.willLink,d.didLink=n.didLink||d.didLink,d.willSync=n.willSync||d.willSync,d.didSync=n.didSync||d.didSync,d.willUnlink=n.willUnlink||d.willUnlink,d.didUnlink=n.didUnlink||d.didUnlink,d.didConnect=n.didConnect||d.didConnect,d.didDisconnect=n.didDisconnect||d.didDisconnect,d.didClose=n.didClose||d.didClose,d.didFail=n.didFail||d.didFail),this._context=t,this._owner=e,this._hostUri=r,this._nodeUri=s,this._laneUri=h,this._prio=l,this._rate=u,this._body=a,this._flags=p,this._model=null,this._observers=c}return t.prototype.hostUri=function(t){return void 0===t?this._hostUri:(t=i.Uri.fromAny(t),this.copy(this._context,this._owner,t,this._nodeUri,this._laneUri,this._prio,this._rate,this._body,this._flags,this._observers))},t.prototype.nodeUri=function(t){return void 0===t?this._nodeUri:(t=i.Uri.fromAny(t),this.copy(this._context,this._owner,this._hostUri,t,this._laneUri,this._prio,this._rate,this._body,this._flags,this._observers))},t.prototype.laneUri=function(t){return void 0===t?this._laneUri:(t=i.Uri.fromAny(t),this.copy(this._context,this._owner,this._hostUri,this._nodeUri,t,this._prio,this._rate,this._body,this._flags,this._observers))},t.prototype.prio=function(t){return void 0===t?this._prio:this.copy(this._context,this._owner,this._hostUri,this._nodeUri,this._laneUri,t,this._rate,this._body,this._flags,this._observers)},t.prototype.rate=function(t){return void 0===t?this._rate:this.copy(this._context,this._owner,this._hostUri,this._nodeUri,this._laneUri,this._prio,t,this._body,this._flags,this._observers)},t.prototype.body=function(t){return void 0===t?this._body:(t=o.Value.fromAny(t),this.copy(this._context,this._owner,this._hostUri,this._nodeUri,this._laneUri,this._prio,this._rate,t,this._flags,this._observers))},t.prototype.keepLinked=function(t){if(void 0===t)return 0!=(1&this._flags);var e=t?1|this._flags:-2&this._flags;return this.copy(this._context,this._owner,this._hostUri,this._nodeUri,this._laneUri,this._prio,this._rate,this._body,e,this._observers)},t.prototype.keepSynced=function(t){if(void 0===t)return 0!=(2&this._flags);var e=t?2|this._flags:-3&this._flags;return this.copy(this._context,this._owner,this._hostUri,this._nodeUri,this._laneUri,this._prio,this._rate,this._body,e,this._observers)},t.prototype.observe=function(t){for(var e=this._observers,i=e?e.length:0,o=new Array(i+1),n=0;n<i;n+=1)o[n]=e[n];return o[i]=t,this._observers=o,this},t.prototype.unobserve=function(t){for(var e=this._observers,i=e?e.length:0,o=0;o<i;o+=1){var n=e[o],r=n===t;if(!r)for(var s in n)if(n[s]===t){r=!0;break}if(r){if(i>1){for(var h=new Array(i-1),l=0;l<o;l+=1)h[l]=e[l];for(l=o+1;l<i;l+=1)h[l-1]=e[l];this._observers=h}else this._observers=null;break}}return this},t.prototype.onEvent=function(t){return this.observe({onEvent:t})},t.prototype.onCommand=function(t){return this.observe({onCommand:t})},t.prototype.willLink=function(t){return this.observe({willLink:t})},t.prototype.didLink=function(t){return this.observe({didLink:t})},t.prototype.willSync=function(t){return this.observe({willSync:t})},t.prototype.didSync=function(t){return this.observe({didSync:t})},t.prototype.willUnlink=function(t){return this.observe({willUnlink:t})},t.prototype.didUnlink=function(t){return this.observe({didUnlink:t})},t.prototype.didConnect=function(t){return this.observe({didConnect:t})},t.prototype.didDisconnect=function(t){return this.observe({didDisconnect:t})},t.prototype.didClose=function(t){return this.observe({didClose:t})},t.prototype.didFail=function(t){return this.observe({didFail:t})},t.prototype.isConnected=function(){return!!this._model&&this._model.isConnected()},t.prototype.isAuthenticated=function(){return!!this._model&&this._model.isAuthenticated()},t.prototype.isLinked=function(){return!!this._model&&this._model.isLinked()},t.prototype.isSynced=function(){return!!this._model&&this._model.isSynced()},t.prototype.session=function(){return this._model?this._model.session():o.Value.absent()},t.prototype.onEventMessage=function(t){for(var e=this._observers,i=e?e.length:0,o=0;o<i;o+=1){var n=e[o];n.onEvent&&n.onEvent(t.body(),this)}},t.prototype.onCommandMessage=function(t){for(var e=this._observers,i=e?e.length:0,o=0;o<i;o+=1){var n=e[o];n.onCommand&&n.onCommand(t,this)}},t.prototype.onLinkRequest=function(t){for(var e=this._observers,i=e?e.length:0,o=0;o<i;o+=1){var n=e[o];n.willLink&&n.willLink(this)}},t.prototype.onLinkedResponse=function(t){for(var e=this._observers,i=e?e.length:0,o=0;o<i;o+=1){var n=e[o];n.didLink&&n.didLink(this)}},t.prototype.onSyncRequest=function(t){for(var e=this._observers,i=e?e.length:0,o=0;o<i;o+=1){var n=e[o];n.willSync&&n.willSync(this)}},t.prototype.onSyncedResponse=function(t){for(var e=this._observers,i=e?e.length:0,o=0;o<i;o+=1){var n=e[o];n.didSync&&n.didSync(this)}},t.prototype.onUnlinkRequest=function(t){for(var e=this._observers,i=e?e.length:0,o=0;o<i;o+=1){var n=e[o];n.willUnlink&&n.willUnlink(this)}},t.prototype.onUnlinkedResponse=function(t){for(var e=this._observers,i=e?e.length:0,o=0;o<i;o+=1){var n=e[o];n.didUnlink&&n.didUnlink(this)}},t.prototype.hostDidConnect=function(){for(var t=this._observers,e=t?t.length:0,i=0;i<e;i+=1){var o=t[i];o.didConnect&&o.didConnect(this)}},t.prototype.hostDidDisconnect=function(){for(var t=this._observers,e=t?t.length:0,i=0;i<e;i+=1){var o=t[i];o.didDisconnect&&o.didDisconnect(this)}},t.prototype.hostDidFail=function(t){for(var e=this._observers,i=e?e.length:0,o=0;o<i;o+=1){var n=e[o];n.didFail&&n.didFail(t,this)}},t.prototype.command=function(t){this._model.command(t)},t.prototype.close=function(){this._owner&&this._owner.removeDownlink(this),this._model&&this._model.removeDownlink(this)},t.prototype.openUp=function(t){},t.prototype.closeUp=function(){for(var t=this._observers,e=t?t.length:0,i=0;i<e;i+=1){var o=t[i];o.didClose&&o.didClose(this)}},t.initForm=function(){return t._initForm||(t._initForm=new m),t._initForm},t}(),m=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return a(e,t),e.prototype.tag=function(e){return 0===arguments.length?"link":void 0!==e?t.prototype.tag.call(this,e):this},e.prototype.mold=function(t){if(t){var e=o.Record.create();return void 0!==t.hostUri&&e.slot("host",i.Uri.fromAny(t.hostUri).toString()),void 0!==t.nodeUri&&e.slot("node",i.Uri.fromAny(t.nodeUri).toString()),void 0!==t.laneUri&&e.slot("lane",i.Uri.fromAny(t.laneUri).toString()),void 0!==t.prio&&e.slot("prio",t.prio),void 0!==t.rate&&e.slot("rate",t.rate),void 0!==t.body&&e.slot("body",t.body),void 0!==t.type&&e.slot("type",t.type),o.Record.of(o.Attr.of("link",e))}return o.Item.extant()},e.prototype.cast=function(t){var e=t.toValue().get("link");if(e.isDefined()){var o={},n=e.get("host");n.isDefined()&&(o.hostUri=n.cast(i.Uri.form()));var r=e.get("node");r.isDefined()&&(o.nodeUri=r.cast(i.Uri.form()));var s=e.get("lane");s.isDefined()&&(o.laneUri=s.cast(i.Uri.form()));var h=e.get("prio");h.isDefined()&&(o.prio=h.numberValue());var l=e.get("rate");l.isDefined()&&(o.rate=l.numberValue());var u=e.get("body");u.isDefined()&&(o.body=u);var a=e.get("type");return a.isDefined()&&(o.type=a.stringValue()),o}},e}(o.Form),w=function(t){function e(e,i,o,n,r,s,h){return t.call(this,e,i,o,n,r,s,h)||this}return a(e,t),e.prototype.type=function(){return"event"},e}(_),k=function(t){function e(e,i,o,n,r,s,h,l,u,a,p){return void 0===a&&(a=1),t.call(this,e,i,o,n,r,s,h,l,u,a,p)||this}return a(e,t),e.prototype.copy=function(t,i,o,n,r,s,h,l,u,a){return new e(t,i,void 0,o,n,r,s,h,l,u,a)},e.prototype.type=function(){return"event"},e.prototype.observe=function(e){return t.prototype.observe.call(this,e)},e.prototype.open=function(){var t=this._laneUri;if(t.isEmpty())throw new Error("no lane");var e=this._nodeUri;if(e.isEmpty())throw new Error("no node");var i=this._hostUri;i.isEmpty()&&(i=e.endpoint(),e=i.unresolve(e));var o=this._context.getDownlink(i,e,t);if(o){if(!(o instanceof w))throw new Error("downlink type mismatch");o.addDownlink(this)}else(o=new w(this._context,i,e,t,this._prio,this._rate,this._body)).addDownlink(this),this._context.openDownlink(o);return this._model=o,this._owner&&this._owner.addDownlink(this),this},e}(y),g=function(t){function i(i,o,n,r,s,h,l,u){void 0===u&&(u=new e.STree);var a=t.call(this,i,o,n,r,s,h,l)||this;return a._state=u,a}return a(i,t),i.prototype.type=function(){return"list"},i.prototype.isEmpty=function(){return this._state.isEmpty()},Object.defineProperty(i.prototype,"length",{get:function(){return this._state.length},enumerable:!0,configurable:!0}),i.prototype.get=function(t,e){return this._state.get(t,e)||o.Value.absent()},i.prototype.getEntry=function(t,e){return this._state.getEntry(t,e)},i.prototype.set=function(t,e,i){if(void 0!==i&&(t=this._state.lookup(i,t))<0)throw new RangeError(""+i);if(t<0||t>=this._state.length)throw new RangeError(""+t);e=this.listWillUpdate(t,e);var n=this._state.getEntry(t);this._state.set(t,e),this.listDidUpdate(t,e,n[1]);var r=o.Record.create(2).slot("key",n[0]).slot("index",t);return this.command(o.Attr.of("update",r).concat(e)),this},i.prototype.insert=function(t,e,i){if(t<0||t>this._state.length)throw new RangeError(""+t);e=this.listWillUpdate(t,e),this._state.insert(t,e,i);var n=this._state.getEntry(t);this.listDidUpdate(t,e,o.Value.absent());var r=o.Record.create(2).slot("key",n[0]).slot("index",t);return this.command(o.Attr.of("update",r).concat(e)),this},i.prototype.remove=function(t,e){if(void 0!==e&&(t=this._state.lookup(e,t))<0)throw new RangeError(""+e);if(t<0||t>this._state.length)throw new RangeError(""+t);this.listWillRemove(t);var i=this._state.getEntry(t);this._state.remove(t),this.listDidRemove(t,i[1]);var n=o.Record.create(2).slot("key",i[0]).slot("index",t);return this.command(o.Record.create(1).attr("remove",n)),this},i.prototype.push=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];for(var i=0;i<t.length;i+=1){var n=this._state.length+i,r=this.listWillUpdate(n,t[i]);this._state.insert(n,r);var s=this._state.getEntry(n);this.listDidUpdate(n,r,o.Value.absent());var h=o.Record.create(2).slot("key",s[0]).slot("index",n);this.command(o.Attr.of("update",h).concat(r))}return this._state.length},i.prototype.pop=function(){var t=this._state.length-1;if(t>=0){this.listWillRemove(t);var e=this._state.getEntry(t);this._state.remove(t),this.listDidRemove(t,e[1]);var i=o.Record.create(2).slot("key",e[0]).slot("index",t);return this.command(o.Record.create(1).attr("remove",i)),e[1]}return o.Value.absent()},i.prototype.unshift=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];for(var i=t.length-1;i>=0;i-=1){var n=this.listWillUpdate(0,t[i]);this._state.insert(0,n);var r=this._state.getEntry(0);this.listDidUpdate(0,n,o.Value.absent());var s=o.Record.create(2).slot("key",r[0]).slot("index",0);this.command(o.Attr.of("update",s).concat(n))}return this._state.length},i.prototype.shift=function(){if(this._state.length>0){this.listWillRemove(0);var t=this._state.getEntry(0);this._state.remove(0),this.listDidRemove(0,t[1]);var e=o.Record.create(2).slot("key",t[0]).slot("index",0);return this.command(o.Record.create(1).attr("remove",e)),t[1]}return o.Value.absent()},i.prototype.move=function(t,e,i){if(void 0!==i&&(t=this._state.lookup(i,t))<0)throw new RangeError(""+i);if(t<0||t>=this._state.length)throw new RangeError(""+t);if(e<0||e>=this._state.length)throw new RangeError(""+e);if(t!==e){var n=this._state.getEntry(t);this.listWillMove(t,e,n[1]),this._state.remove(t).insert(e,n[1],n[0]),this.listDidMove(t,e,n[1]);var r=o.Record.create(2).slot("key",n[0]).slot("from",t).slot("to",e);this.command(o.Record.create(1).attr("move",r))}return this},i.prototype.splice=function(t,e){for(var i=[],n=2;n<arguments.length;n++)i[n-2]=arguments[n];t<0&&(t=this._state.length+t),t=Math.min(Math.max(0,t),this._state.length),void 0===e&&(e=this._state.length-t);for(var r=[],s=t,h=t+e;s<h;s+=1){this.listWillRemove(t);var l=this._state.getEntry(t);r.push(l[1]),this._state.remove(t),this.listDidRemove(t,l[1]);var u=o.Record.create(2).slot("key",l[0]).slot("index",t);this.command(o.Record.create(1).attr("remove",u))}for(s=0;s<i.length;s+=1){var a=t+s,p=this.listWillUpdate(a,i[s]);this._state.insert(a,p);var c=this._state.getEntry(a);this.listDidUpdate(a,p,o.Value.absent());u=o.Record.create(2).slot("key",c[0]).slot("index",a);this.command(o.Attr.of("update",u).concat(p))}return r},i.prototype.clear=function(){this.listWillClear(),this._state.clear(),this.listDidClear(),this.command(o.Record.create(1).attr("clear"))},i.prototype.forEach=function(t,e){return this._state.forEach((function(i,o,n,r){return t.call(e,i,o,this,r)}),this)},i.prototype.values=function(){return this._state.values()},i.prototype.keys=function(){return this._state.keys()},i.prototype.entries=function(){return this._state.entries()},i.prototype.snapshot=function(){return this._state.clone()},i.prototype.setState=function(t){this._state=t},i.prototype.onEventMessage=function(e,i){t.prototype.onEventMessage.call(this,e,i);var o=e.body(),n=o.tag();if("update"===n){var r=o.head().toValue();(s=this._state.lookup(r.get("key"),r.get("index").numberValue()))>=0?this.onUpdateEvent(s,o.body(),r.get("key")):this.onInsertEvent(r.get("index").numberValue(0),o.body(),r.get("key"))}else if("move"===n){r=o.head().toValue();(s=this._state.lookup(r.get("key"),r.get("from").numberValue()))>=0&&this.onMoveEvent(s,r.get("to").numberValue(0),r.get("key"))}else if("remove"===n){var s;r=o.head().toValue();(s=this._state.lookup(r.get("key"),r.get("index").numberValue()))>=0&&this.onRemoveEvent(s,r.get("key"))}else if("drop"===n){r=o.head();this.onDropEvent(r.numberValue(0))}else if("take"===n){r=o.head();this.onTakeEvent(r.numberValue(0))}else"clear"===n&&this.onClearEvent()},i.prototype.onInsertEvent=function(t,e,i){e=this.listWillUpdate(t,e),this._state.insert(t,e,i),this.listDidUpdate(t,e,o.Value.absent())},i.prototype.onUpdateEvent=function(t,e,i){e=this.listWillUpdate(t,e);var n=this._state.get(t)||o.Value.absent();this._state.set(t,e),this.listDidUpdate(t,e,n)},i.prototype.onMoveEvent=function(t,e,i){if(t!==(e=Math.min(Math.max(0,e),this._state.length))){var n=this._state.get(t)||o.Value.absent();this.listWillMove(t,e,n),this._state.remove(t).insert(e,n,i),this.listDidMove(t,e,n)}},i.prototype.onRemoveEvent=function(t,e){this.listWillRemove(t);var i=this._state.get(t)||o.Value.absent();this._state.remove(t),this.listDidRemove(t,i)},i.prototype.onDropEvent=function(t){this.listWillDrop(t),this._state.drop(t),this.listDidDrop(t)},i.prototype.onTakeEvent=function(t){this.listWillTake(t),this._state.take(t),this.listDidTake(t)},i.prototype.onClearEvent=function(){this.listWillClear(),this._state.clear(),this.listDidClear()},i.prototype.listWillUpdate=function(t,e){for(var i=0;i<this._views.length;i+=1)e=this._views[i].listWillUpdate(t,e);return e},i.prototype.listDidUpdate=function(t,e,i){for(var o=0;o<this._views.length;o+=1)this._views[o].listDidUpdate(t,e,i)},i.prototype.listWillMove=function(t,e,i){for(var o=0;o<this._views.length;o+=1)this._views[o].listWillMove(t,e,i)},i.prototype.listDidMove=function(t,e,i){for(var o=0;o<this._views.length;o+=1)this._views[o].listDidMove(t,e,i)},i.prototype.listWillRemove=function(t){for(var e=0;e<this._views.length;e+=1)this._views[e].listWillRemove(t)},i.prototype.listDidRemove=function(t,e){for(var i=0;i<this._views.length;i+=1)this._views[i].listDidRemove(t,e)},i.prototype.listWillDrop=function(t){for(var e=0;e<this._views.length;e+=1)this._views[e].listWillDrop(t)},i.prototype.listDidDrop=function(t){for(var e=0;e<this._views.length;e+=1)this._views[e].listDidDrop(t)},i.prototype.listWillTake=function(t){for(var e=0;e<this._views.length;e+=1)this._views[e].listWillTake(t)},i.prototype.listDidTake=function(t){for(var e=0;e<this._views.length;e+=1)this._views[e].listDidTake(t)},i.prototype.listWillClear=function(){for(var t=0;t<this._views.length;t+=1)this._views[t].listWillClear()},i.prototype.listDidClear=function(){for(var t=0;t<this._views.length;t+=1)this._views[t].listDidClear()},i}(_),b=function(t){function e(e,i,n,r,s,h,l,u,a,p,c,d,f){void 0===p&&(p=3);var v=t.call(this,e,i,n,r,s,h,l,u,a,p,c)||this;if(n){var _=v._observers[v._observers.length-1];_.willUpdate=n.willUpdate||_.willUpdate,_.didUpdate=n.didUpdate||_.didUpdate,_.willMove=n.willMove||_.willMove,_.didMove=n.didMove||_.didMove,_.willRemove=n.willRemove||_.willRemove,_.didRemove=n.didRemove||_.didRemove,_.willDrop=n.willDrop||_.willDrop,_.didDrop=n.didDrop||_.didDrop,_.willTake=n.willTake||_.willTake,_.didTake=n.didTake||_.didTake,_.willClear=n.willClear||_.willClear,_.didClear=n.didClear||_.didClear,d=n.valueForm?n.valueForm:d}return v._valueForm=d||o.Form.forValue(),v._state0=f,v}return a(e,t),e.prototype.copy=function(t,i,o,n,r,s,h,l,u,a,p,c){return 10===arguments.length&&(p=this._valueForm,c=this._state0),new e(t,i,void 0,o,n,r,s,h,l,u,a,p,c)},e.prototype.type=function(){return"list"},e.prototype.valueForm=function(t){return void 0===t?this._valueForm:this.copy(this._context,this._owner,this._hostUri,this._nodeUri,this._laneUri,this._prio,this._rate,this._body,this._flags,this._observers,t,this._state0)},e.prototype.isEmpty=function(){return this._model.isEmpty()},Object.defineProperty(e.prototype,"length",{get:function(){return this._model.length},enumerable:!0,configurable:!0}),e.prototype.get=function(t,e){return this._model.get(t,e).coerce(this._valueForm)},e.prototype.getEntry=function(t,e){var i=this._model.getEntry(t,e);if(i)return[i[0].coerce(this._valueForm),i[1]]},e.prototype.set=function(t,e,i){var o=this._valueForm.mold(e);return this._model.set(t,o,i),this},e.prototype.insert=function(t,e,i){var o=this._valueForm.mold(e);return this._model.insert(t,o,i),this},e.prototype.remove=function(t,e){return this._model.remove(t,e),this},e.prototype.push=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];for(var i=new Array(t.length),o=0;o<t.length;o+=1)i[o]=this._valueForm.mold(t[o]);return this._model.push.apply(this._model,i)},e.prototype.pop=function(){return this._model.pop().coerce(this._valueForm)},e.prototype.unshift=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];for(var i=new Array(t.length),o=0;o<t.length;o+=1)i[o]=this._valueForm.mold(t[o]);return this._model.unshift.apply(this._model,i)},e.prototype.shift=function(){return this._model.shift().coerce(this._valueForm)},e.prototype.move=function(t,e,i){return this._model.move(t,e,i),this},e.prototype.splice=function(t,e){for(var i,o=[],n=2;n<arguments.length;n++)o[n-2]=arguments[n];for(var r=new Array(o.length),s=0;s<o.length;s+=1)r[s]=this._valueForm.mold(o[s]);var h=(i=this._model).splice.apply(i,c([t,e],r)),l=new Array(h.length);for(s=0;s<h.length;s+=1)l[s]=h[s].coerce(this._valueForm);return l},e.prototype.clear=function(){this._model.clear()},e.prototype.forEach=function(t,e){return this._valueForm===o.Form.forValue()?this._model._state.forEach(t,e):this._model._state.forEach((function(i,o,n,r){var s=i.coerce(this._valueForm);return t.call(e,s,o,this,r)}),this)},e.prototype.values=function(){var t=this._model.values();return this._valueForm===o.Form.forValue()?t:new o.ValueCursor(t,this._valueForm)},e.prototype.keys=function(){return this._model.keys()},e.prototype.entries=function(){var t=this._model.entries();return this._valueForm===o.Form.forValue()?t:new o.ValueEntryCursor(t,o.Form.forValue(),this._valueForm)},e.prototype.snapshot=function(){return this._model.snapshot()},e.prototype.setState=function(t){this._model.setState(t)},e.prototype.observe=function(e){return t.prototype.observe.call(this,e)},e.prototype.willUpdate=function(t){return this.observe({willUpdate:t})},e.prototype.didUpdate=function(t){return this.observe({didUpdate:t})},e.prototype.willMove=function(t){return this.observe({willMove:t})},e.prototype.didMove=function(t){return this.observe({didMove:t})},e.prototype.willRemove=function(t){return this.observe({willRemove:t})},e.prototype.didRemove=function(t){return this.observe({didRemove:t})},e.prototype.willDrop=function(t){return this.observe({willDrop:t})},e.prototype.didDrop=function(t){return this.observe({didDrop:t})},e.prototype.willTake=function(t){return this.observe({willTake:t})},e.prototype.didTake=function(t){return this.observe({didTake:t})},e.prototype.willClear=function(t){return this.observe({willClear:t})},e.prototype.didClear=function(t){return this.observe({didClear:t})},e.prototype.listWillUpdate=function(t,e){for(var i,o=this._observers,n=o?o.length:0,r=0;r<n;r+=1){var s=o[r];if(s.willUpdate){void 0===i&&(i=e.coerce(this._valueForm));var h=s.willUpdate(t,i,this);void 0!==h&&(i=h,e=this._valueForm.mold(i))}}return e},e.prototype.listDidUpdate=function(t,e,i){for(var o,n,r=this._observers,s=r?r.length:0,h=0;h<s;h+=1){var l=r[h];l.didUpdate&&(void 0===o&&(o=e.coerce(this._valueForm)),void 0===n&&(n=i.coerce(this._valueForm)),l.didUpdate(t,o,n,this))}},e.prototype.listWillMove=function(t,e,i){for(var o,n=this._observers,r=n?n.length:0,s=0;s<r;s+=1){var h=n[s];h.willMove&&(void 0===o&&(o=i.coerce(this._valueForm)),h.willMove(t,e,o,this))}},e.prototype.listDidMove=function(t,e,i){for(var o,n=this._observers,r=n?n.length:0,s=0;s<r;s+=1){var h=n[s];h.didMove&&(void 0===o&&(o=i.coerce(this._valueForm)),h.didMove(t,e,o,this))}},e.prototype.listWillRemove=function(t){for(var e=this._observers,i=e?e.length:0,o=0;o<i;o+=1){var n=e[o];n.willRemove&&n.willRemove(t,this)}},e.prototype.listDidRemove=function(t,e){for(var i,o=this._observers,n=o?o.length:0,r=0;r<n;r+=1){var s=o[r];s.didRemove&&(void 0===i&&(i=e.coerce(this._valueForm)),s.didRemove(t,i,this))}},e.prototype.listWillDrop=function(t){for(var e=this._observers,i=e?e.length:0,o=0;o<i;o+=1){var n=e[o];n.willDrop&&n.willDrop(t,this)}},e.prototype.listDidDrop=function(t){for(var e=this._observers,i=e?e.length:0,o=0;o<i;o+=1){var n=e[o];n.didDrop&&n.didDrop(t,this)}},e.prototype.listWillTake=function(t){for(var e=this._observers,i=e?e.length:0,o=0;o<i;o+=1){var n=e[o];n.willTake&&n.willTake(t,this)}},e.prototype.listDidTake=function(t){for(var e=this._observers,i=e?e.length:0,o=0;o<i;o+=1){var n=e[o];n.didTake&&n.didTake(t,this)}},e.prototype.listWillClear=function(){for(var t=this._observers,e=t?t.length:0,i=0;i<e;i+=1){var o=t[i];o.willClear&&o.willClear(this)}},e.prototype.listDidClear=function(){for(var t=this._observers,e=t?t.length:0,i=0;i<e;i+=1){var o=t[i];o.didClear&&o.didClear(this)}},e.prototype.initialState=function(t){return void 0===t?this._state0||null:this.copy(this._context,this._owner,this._hostUri,this._nodeUri,this._laneUri,this._prio,this._rate,this._body,this._flags,this._observers,this._valueForm,t||void 0)},e.prototype.didAliasModel=function(){this.onLinkedResponse(),this._model._state.forEach((function(t,e){this.listDidUpdate(e,t,o.Value.absent())}),this),this.onSyncedResponse()},e.prototype.open=function(){var t=this._laneUri;if(t.isEmpty())throw new Error("no lane");var e=this._nodeUri;if(e.isEmpty())throw new Error("no node");var i=this._hostUri;i.isEmpty()&&(i=e.endpoint(),e=i.unresolve(e));var o=this._context.getDownlink(i,e,t);if(o){if(!(o instanceof g))throw new Error("downlink type mismatch");o.addDownlink(this),this._model=o,setTimeout(this.didAliasModel.bind(this))}else(o=new g(this._context,i,e,t,this._prio,this._rate,this._body,this._state0)).addDownlink(this),this._context.openDownlink(o),this._model=o;return this._owner&&this._owner.addDownlink(this),this},e}(y),U=function(t){function i(i,o,n,r,s,h,l,u){void 0===u&&(u=new e.BTree);var a=t.call(this,i,o,n,r,s,h,l)||this;return a._state=u,a}return a(i,t),i.prototype.type=function(){return"map"},Object.defineProperty(i.prototype,"size",{get:function(){return this._state.size},enumerable:!0,configurable:!0}),i.prototype.isEmpty=function(){return this._state.isEmpty()},i.prototype.has=function(t){return this._state.has(t)},i.prototype.get=function(t){return this._state.get(t)||o.Value.absent()},i.prototype.getEntry=function(t){return this._state.getEntry(t)},i.prototype.set=function(t,e){e=this.mapWillUpdate(t,e);var i=this._state.get(t)||o.Value.absent();this._state.set(t,e),this.mapDidUpdate(t,e,i);var n=o.Record.create(1).slot("key",t);return this.command(o.Attr.of("update",n).concat(e)),this},i.prototype.delete=function(t){if(this._state.has(t)){this.mapWillRemove(t);var e=this._state.get(t)||o.Value.absent();this._state.delete(t),this.mapDidRemove(t,e);var i=o.Record.create(1).slot("key",t);return this.command(o.Record.create(1).attr("remove",i)),!0}return!1},i.prototype.drop=function(t){return this.mapWillDrop(t),this._state.drop(t),this.mapDidDrop(t),this.command(o.Record.create(1).attr("drop",t)),this},i.prototype.take=function(t){return this.mapWillTake(t),this._state.take(t),this.mapDidTake(t),this.command(o.Record.create(1).attr("take",t)),this},i.prototype.clear=function(){this.mapWillClear(),this._state.clear(),this.mapDidClear(),this.command(o.Record.create(1).attr("clear"))},i.prototype.forEach=function(t,e){return this._state.forEach((function(i,o){return t.call(e,i,o,this)}),this)},i.prototype.keys=function(){return this._state.keys()},i.prototype.values=function(){return this._state.values()},i.prototype.entries=function(){return this._state.entries()},i.prototype.snapshot=function(){return this._state.clone()},i.prototype.setState=function(t){this._state=t},i.prototype.onEventMessage=function(e,i){t.prototype.onEventMessage.call(this,e,i);var o=e.body(),n=o.tag();if("update"===n){var r=o.head().toValue();this.onUpdateEvent(r.get("key"),o.body())}else if("remove"===n){r=o.head().toValue();this.onRemoveEvent(r.get("key"))}else if("drop"===n){r=o.head().toValue();this.onDropEvent(r.numberValue(0))}else if("take"===n){r=o.head().toValue();this.onTakeEvent(r.numberValue(0))}else"clear"===n&&this.onClearEvent()},i.prototype.onUpdateEvent=function(t,e){e=this.mapWillUpdate(t,e);var i=this._state.get(t)||o.Value.absent();this._state.set(t,e),this.mapDidUpdate(t,e,i)},i.prototype.onRemoveEvent=function(t){this.mapWillRemove(t);var e=this._state.get(t)||o.Value.absent();this._state.delete(t),this.mapDidRemove(t,e)},i.prototype.onDropEvent=function(t){this.mapWillDrop(t),this._state.drop(t),this.mapDidDrop(t)},i.prototype.onTakeEvent=function(t){this.mapWillTake(t),this._state.take(t),this.mapDidTake(t)},i.prototype.onClearEvent=function(){this.mapWillClear(),this._state.clear(),this.mapDidClear()},i.prototype.mapWillUpdate=function(t,e){for(var i=0;i<this._views.length;i+=1)e=this._views[i].mapWillUpdate(t,e);return e},i.prototype.mapDidUpdate=function(t,e,i){for(var o=0;o<this._views.length;o+=1)this._views[o].mapDidUpdate(t,e,i)},i.prototype.mapWillRemove=function(t){for(var e=0;e<this._views.length;e+=1)this._views[e].mapWillRemove(t)},i.prototype.mapDidRemove=function(t,e){for(var i=0;i<this._views.length;i+=1)this._views[i].mapDidRemove(t,e)},i.prototype.mapWillDrop=function(t){for(var e=0;e<this._views.length;e+=1)this._views[e].mapWillDrop(t)},i.prototype.mapDidDrop=function(t){for(var e=0;e<this._views.length;e+=1)this._views[e].mapDidDrop(t)},i.prototype.mapWillTake=function(t){for(var e=0;e<this._views.length;e+=1)this._views[e].mapWillTake(t)},i.prototype.mapDidTake=function(t){for(var e=0;e<this._views.length;e+=1)this._views[e].mapDidTake(t)},i.prototype.mapWillClear=function(){for(var t=0;t<this._views.length;t+=1)this._views[t].mapWillClear()},i.prototype.mapDidClear=function(){for(var t=0;t<this._views.length;t+=1)this._views[t].mapDidClear()},i}(_),D=function(t){function i(i,n,r,s,h,l,u,a,p,c,d,f,v,_){void 0===c&&(c=3);var y=t.call(this,i,n,r,s,h,l,u,a,p,c,d)||this;if(r){var m=y._observers[y._observers.length-1];m.willUpdate=r.willUpdate||m.willUpdate,m.didUpdate=r.didUpdate||m.didUpdate,m.willRemove=r.willRemove||m.willRemove,m.didRemove=r.didRemove||m.didRemove,m.willDrop=r.willDrop||m.willDrop,m.didDrop=r.didDrop||m.didDrop,m.willTake=r.willTake||m.willTake,m.didTake=r.didTake||m.didTake,m.willClear=r.willClear||m.willClear,m.didClear=r.didClear||m.didClear,f=r.keyForm?r.keyForm:f,v=r.valueForm?r.valueForm:v}return y._keyForm=f||o.Form.forValue(),y._valueForm=v||o.Form.forValue(),y._state0=_,y._input=null,y._effects=new e.BTree,y._outlets=new e.BTree,y._outputs=null,y._version=-1,y}return a(i,t),i.prototype.copy=function(t,e,o,n,r,s,h,l,u,a,p,c,d){return 10===arguments.length&&(d=this._state0,p=this._keyForm,c=this._valueForm),new i(t,e,void 0,o,n,r,s,h,l,u,a,p,c,d)},i.prototype.type=function(){return"map"},i.prototype.keyForm=function(t){return void 0===t?this._keyForm:this.copy(this._context,this._owner,this._hostUri,this._nodeUri,this._laneUri,this._prio,this._rate,this._body,this._flags,this._observers,t,this._valueForm,this._state0)},i.prototype.valueForm=function(t){return void 0===t?this._valueForm:this.copy(this._context,this._owner,this._hostUri,this._nodeUri,this._laneUri,this._prio,this._rate,this._body,this._flags,this._observers,this._keyForm,t,this._state0)},Object.defineProperty(i.prototype,"size",{get:function(){return this._model.size},enumerable:!0,configurable:!0}),i.prototype.isEmpty=function(){return this._model.isEmpty()},i.prototype.has=function(t){var e=this._keyForm.mold(t);return this._model.has(e)},i.prototype.get=function(t){if(void 0===t)return this;var e=this._keyForm.mold(t);return this._model.get(e).coerce(this._valueForm)},i.prototype.getEntry=function(t){var e=this._model.getEntry(t);if(e)return[e[0].coerce(this._keyForm),e[1].coerce(this._valueForm)]},i.prototype.firstKey=function(){var t=this._model._state.firstKey();if(void 0!==t){var e=this._keyForm.cast(t);if(void 0!==e)return e}return this._keyForm.unit()},i.prototype.firstValue=function(){var t=this._model._state.firstValue();if(void 0!==t){var e=this._valueForm.cast(t);if(void 0!==e)return e}return this._valueForm.unit()},i.prototype.firstEntry=function(){var t=this._model._state.firstEntry();if(void 0!==t)return[this._keyForm.cast(t[0]),this._valueForm.cast(t[1])]},i.prototype.lastKey=function(){var t=this._model._state.lastKey();if(void 0!==t){var e=this._keyForm.cast(t);if(void 0!==e)return e}return this._keyForm.unit()},i.prototype.lastValue=function(){var t=this._model._state.lastValue();if(void 0!==t){var e=this._valueForm.cast(t);if(void 0!==e)return e}return this._valueForm.unit()},i.prototype.lastEntry=function(){var t=this._model._state.lastEntry();if(void 0!==t)return[this._keyForm.cast(t[0]),this._valueForm.cast(t[1])]},i.prototype.nextKey=function(t){var e=this._keyForm.mold(t),i=this._model._state.nextKey(e);if(void 0!==i){var o=this._keyForm.cast(i);if(void 0!==o)return o}return this._keyForm.unit()},i.prototype.nextValue=function(t){var e=this._keyForm.mold(t),i=this._model._state.nextValue(e);if(void 0!==i){var o=this._valueForm.cast(i);if(void 0!==o)return o}return this._valueForm.unit()},i.prototype.nextEntry=function(t){var e=this._keyForm.mold(t),i=this._model._state.nextEntry(e);if(void 0!==i)return[this._keyForm.cast(i[0]),this._valueForm.cast(i[1])]},i.prototype.previousKey=function(t){var e=this._keyForm.mold(t),i=this._model._state.previousKey(e);if(void 0!==i){var o=this._keyForm.cast(i);if(void 0!==o)return o}return this._keyForm.unit()},i.prototype.previousValue=function(t){var e=this._keyForm.mold(t),i=this._model._state.previousValue(e);if(void 0!==i){var o=this._valueForm.cast(i);if(void 0!==o)return o}return this._valueForm.unit()},i.prototype.previousEntry=function(t){var e=this._keyForm.mold(t),i=this._model._state.previousEntry(e);if(void 0!==i)return[this._keyForm.cast(i[0]),this._valueForm.cast(i[1])]},i.prototype.set=function(t,e){var i=this._keyForm.mold(t),o=this._valueForm.mold(e);return this._model.set(i,o),this},i.prototype.delete=function(t){var e=this._keyForm.mold(t);return this._model.delete(e)},i.prototype.drop=function(t){return this._model.drop(t),this},i.prototype.take=function(t){return this._model.take(t),this},i.prototype.clear=function(){this._model.clear()},i.prototype.forEach=function(t,e){return this._keyForm===o.Form.forValue()&&this._valueForm===o.Form.forValue()?this._model._state.forEach(t,e):this._model._state.forEach((function(i,o){var n=i.coerce(this._keyForm),r=o.coerce(this._valueForm);return t.call(e,n,r,this)}),this)},i.prototype.keys=function(){var t=this._model.keys();return this._keyForm===o.Form.forValue()?t:new o.ValueCursor(t,this._keyForm)},i.prototype.values=function(){var t=this._model.values();return this._valueForm===o.Form.forValue()?t:new o.ValueCursor(t,this._valueForm)},i.prototype.entries=function(){var t=this._model.entries();return this._keyForm===o.Form.forValue()&&this._valueForm===o.Form.forValue()?t:new o.ValueEntryCursor(t,this._keyForm,this._valueForm)},i.prototype.snapshot=function(){return this._model.snapshot()},i.prototype.setState=function(t){this._model.setState(t)},i.prototype.observe=function(e){return t.prototype.observe.call(this,e)},i.prototype.willUpdate=function(t){return this.observe({willUpdate:t})},i.prototype.didUpdate=function(t){return this.observe({didUpdate:t})},i.prototype.willRemove=function(t){return this.observe({willRemove:t})},i.prototype.didRemove=function(t){return this.observe({didRemove:t})},i.prototype.willDrop=function(t){return this.observe({willDrop:t})},i.prototype.didDrop=function(t){return this.observe({didDrop:t})},i.prototype.willTake=function(t){return this.observe({willTake:t})},i.prototype.didTake=function(t){return this.observe({didTake:t})},i.prototype.willClear=function(t){return this.observe({willClear:t})},i.prototype.didClear=function(t){return this.observe({didClear:t})},i.prototype.mapWillUpdate=function(t,e){for(var i,o,n=this._observers,r=n?n.length:0,s=0;s<r;s+=1){var h=n[s];if(h.willUpdate){void 0===i&&(i=t.coerce(this._keyForm)),void 0===o&&(o=e.coerce(this._valueForm));var l=h.willUpdate(i,o,this);void 0!==l&&(o=l,e=this._valueForm.mold(o))}}return e},i.prototype.mapDidUpdate=function(t,e,i){for(var o,n,r=this._observers,s=r?r.length:0,h=t.coerce(this._keyForm),l=0;l<s;l+=1){var u=r[l];u.didUpdate&&(void 0===o&&(o=e.coerce(this._valueForm)),void 0===n&&(n=i.coerce(this._valueForm)),u.didUpdate(h,o,n,this))}this.invalidateInputKey(h,0),this.reconcileInput(0)},i.prototype.mapWillRemove=function(t){for(var e,i=this._observers,o=i?i.length:0,n=0;n<o;n+=1){var r=i[n];r.willRemove&&(void 0===e&&(e=t.coerce(this._keyForm)),r.willRemove(e,this))}},i.prototype.mapDidRemove=function(t,e){for(var i,o=this._observers,n=o?o.length:0,r=t.coerce(this._keyForm),s=0;s<n;s+=1){var h=o[s];h.didRemove&&(void 0===i&&(i=e.coerce(this._valueForm)),h.didRemove(r,i,this))}this.invalidateInputKey(r,1),this.reconcileInput(0)},i.prototype.mapWillDrop=function(t){for(var e=this._observers,i=e?e.length:0,o=0;o<i;o+=1){var n=e[o];n.willDrop&&n.willDrop(t,this)}},i.prototype.mapDidDrop=function(t){for(var e=this._observers,i=e?e.length:0,o=0;o<i;o+=1){var n=e[o];n.didDrop&&n.didDrop(t,this)}},i.prototype.mapWillTake=function(t){for(var e=this._observers,i=e?e.length:0,o=0;o<i;o+=1){var n=e[o];n.willTake&&n.willTake(t,this)}},i.prototype.mapDidTake=function(t){for(var e=this._observers,i=e?e.length:0,o=0;o<i;o+=1){var n=e[o];n.didTake&&n.didTake(t,this)}},i.prototype.mapWillClear=function(){for(var t=this._observers,e=t?t.length:0,i=0;i<e;i+=1){var o=t[i];o.willClear&&o.willClear(this)}},i.prototype.mapDidClear=function(){for(var t=this._observers,e=t?t.length:0,i=0;i<e;i+=1){var o=t[i];o.didClear&&o.didClear(this)}},i.prototype.initialState=function(t){return void 0===t?this._state0||null:this.copy(this._context,this._owner,this._hostUri,this._nodeUri,this._laneUri,this._prio,this._rate,this._body,this._flags,this._observers,this._keyForm,this._valueForm,t||void 0)},i.prototype.didAliasModel=function(){this.onLinkedResponse(),this._model._state.forEach((function(t,e){this.mapDidUpdate(t,e,o.Value.absent())}),this),this.onSyncedResponse()},i.prototype.open=function(){var t=this._laneUri;if(t.isEmpty())throw new Error("no lane");var e=this._nodeUri;if(e.isEmpty())throw new Error("no node");var i=this._hostUri;i.isEmpty()&&(i=e.endpoint(),e=i.unresolve(e));var o=this._context.getDownlink(i,e,t);if(o){if(!(o instanceof U))throw new Error("downlink type mismatch");o.addDownlink(this),this._model=o,setTimeout(this.didAliasModel.bind(this))}else(o=new U(this._context,i,e,t,this._prio,this._rate,this._body,this._state0)).addDownlink(this),this._context.openDownlink(o),this._model=o;return this._owner&&this._owner.addDownlink(this),this},i.prototype.keyIterator=function(){return this.keys()},i.prototype.input=function(){return this._input},i.prototype.bindInput=function(t){if(!s.MapOutlet.is(t))throw new TypeError(""+t);null!==this._input&&this._input.unbindOutput(this),this._input=t,null!==this._input&&this._input.bindOutput(this)},i.prototype.unbindInput=function(){null!==this._input&&this._input.unbindOutput(this),this._input=null},i.prototype.disconnectInputs=function(){var t=this._input;null!==t&&(t.unbindOutput(this),this._input=null,t.disconnectInputs())},i.prototype.outlet=function(t){var e=this._outlets.get(t);return void 0===e&&(e=new s.KeyOutlet(this,t),this._outlets=this._outlets.updated(t,e)),e},i.prototype.outputIterator=function(){return null!==this._outputs?r.Cursor.array(this._outputs):r.Cursor.empty()},i.prototype.bindOutput=function(t){for(var e=this._outputs,i=null!==e?e.length:0,o=new Array(i+1),n=0;n<i;n+=1)o[n]=e[n];o[i]=t,this._outputs=o},i.prototype.unbindOutput=function(t){for(var e=this._outputs,i=null!==e?e.length:0,o=0;o<i;o+=1)if(e[o]===t){if(i>1){for(var n=new Array(i-1),r=0;r<o;r+=1)n[r]=e[r];for(r=o;r<i-1;r+=1)n[r]=e[r+1];this._outputs=n}else this._outputs=null;break}},i.prototype.unbindOutputs=function(){var t=this._outputs;if(null!==t){this._outputs=null;for(var e=0,i=t.length;e<i;e+=1)t[e].unbindInput()}},i.prototype.disconnectOutputs=function(){var t=this._outlets;t.isEmpty()&&(this._outlets=new e.BTree,t.forEach((function(t,e){e.disconnectOutputs()}),this));var i=this._outputs;if(null!==i){this._outputs=null;for(var o=0,n=i.length;o<n;o+=1){var r=i[o];r.unbindInput(),r.disconnectOutputs()}}},i.prototype.invalidateOutputKey=function(t,e){this.invalidateKey(t,e)},i.prototype.invalidateInputKey=function(t,e){this.invalidateKey(t,e)},i.prototype.invalidateKey=function(t,e){var i=this._effects;if(i.get(t)!==e){this.willInvalidateKey(t,e),this._effects=i.updated(t,e),this._version=-1,this.onInvalidateKey(t,e);for(var o=null!==this._outputs?this._outputs.length:0,n=0;n<o;n+=1){var r=this._outputs[n];s.MapInlet.is(r)?r.invalidateOutputKey(t,e):r.invalidateOutput()}var h=this._outlets.get(t);void 0!==h&&h.invalidateInput(),this.didInvalidateKey(t,e)}},i.prototype.invalidateOutput=function(){this.invalidate()},i.prototype.invalidateInput=function(){this.invalidate()},i.prototype.invalidate=function(){if(this._version>=0){this.willInvalidate(),this._version=-1,this.onInvalidate();for(var t=null!==this._outputs?this._outputs.length:0,e=0;e<t;e+=1)this._outputs[e].invalidateOutput();this._outlets.forEach((function(t,e){e.invalidateInput()}),this),this.didInvalidate()}},i.prototype.reconcileOutputKey=function(t,e){this.reconcileKey(t,e)},i.prototype.reconcileInputKey=function(t,e){this.reconcileKey(t,e)},i.prototype.reconcileKey=function(t,e){if(this._version<0){var i=this._effects,o=i.get(t);if(void 0!==o){this.willReconcileKey(t,o,e),this._effects=i.removed(t),null!==this._input&&this._input.reconcileInputKey(t,e),this.onReconcileKey(t,o,e);for(var n=0,r=null!==this._outputs?this._outputs.length:0;n<r;n+=1){var h=this._outputs[n];s.MapInlet.is(h)&&h.reconcileOutputKey(t,e)}var l=this._outlets.get(t);void 0!==l&&l.reconcileInput(e),this.didReconcileKey(t,o,e)}}},i.prototype.reconcileOutput=function(t){this.reconcile(t)},i.prototype.reconcileInput=function(t){this.reconcile(t)},i.prototype.reconcile=function(t){if(this._version<0){this.willReconcile(t),this._effects.forEach((function(e){this.reconcileKey(e,t)}),this),this._version=t,this.onReconcile(t);for(var e=0,i=null!==this._outputs?this._outputs.length:0;e<i;e+=1)this._outputs[e].reconcileOutput(t);this.didReconcile(t)}},i.prototype.willInvalidateKey=function(t,e){},i.prototype.onInvalidateKey=function(t,e){},i.prototype.didInvalidateKey=function(t,e){},i.prototype.willInvalidate=function(){},i.prototype.onInvalidate=function(){},i.prototype.didInvalidate=function(){},i.prototype.willReconcileKey=function(t,e,i){},i.prototype.onReconcileKey=function(t,e,i){if(0===e){if(null!==this._input){var o=this._input.get(t);void 0!==o?this.set(t,o):this.delete(t)}}else 1===e&&this.delete(t)},i.prototype.didReconcileKey=function(t,e,i){},i.prototype.willReconcile=function(t){},i.prototype.onReconcile=function(t){},i.prototype.didReconcile=function(t){},i.prototype.memoize=function(){return this},i.prototype.filter=function(t){var e=new s.FilterFieldsCombinator(t);return e.bindInput(this),e},i.prototype.map=function(t){var e;return 1===t.length?((e=new s.MapValueCombinator(t)).bindInput(this),e):((e=new s.MapFieldValuesCombinator(t)).bindInput(this),e)},i.prototype.reduce=function(t,e,i){var o=new s.ReduceFieldsCombinator(t,e,i);return o.bindInput(this),o},i.prototype.watch=function(t){return 1===t.length?(new s.WatchValueCombinator(t).bindInput(this),this):(new s.WatchFieldsCombinator(t).bindInput(this),this)},i}(y),R=function(t){function e(e,i,n,r,s,h,l,u){void 0===u&&(u=o.Value.absent());var a=t.call(this,e,i,n,r,s,h,l)||this;return a._state=u,a}return a(e,t),e.prototype.type=function(){return"value"},e.prototype.get=function(){return this._state},e.prototype.set=function(t){t=this.valueWillSet(t);var e=this._state;this.setState(t),this.valueDidSet(t,e),this.command(t)},e.prototype.setState=function(t){this._state=t},e.prototype.onEventMessage=function(e,i){t.prototype.onEventMessage.call(this,e,i),this.onSetEvent(e.body())},e.prototype.onSetEvent=function(t){t=this.valueWillSet(t);var e=this._state;this.setState(t),this.valueDidSet(t,e)},e.prototype.valueWillSet=function(t){for(var e=0;e<this._views.length;e+=1)t=this._views[e].valueWillSet(t);return t},e.prototype.valueDidSet=function(t,e){for(var i=0;i<this._views.length;i+=1)this._views[i].valueDidSet(t,e)},e}(_),E=function(t){function e(e,i,n,r,s,h,l,u,a,p,c,d,f){void 0===p&&(p=3),void 0===f&&(f=o.Value.absent());var v=t.call(this,e,i,n,r,s,h,l,u,a,p,c)||this;if(n){var _=v._observers[v._observers.length-1];_.willSet=n.willSet||_.willSet,_.didSet=n.didSet||_.didSet,d=n.valueForm?n.valueForm:d}return v._valueForm=d||o.Form.forValue(),v._state0=f,v._input=null,v._outputs=null,v._version=-1,v}return a(e,t),e.prototype.copy=function(t,i,o,n,r,s,h,l,u,a,p,c){return 10===arguments.length&&(c=this._state0,p=this._valueForm),new e(t,i,void 0,o,n,r,s,h,l,u,a,p,c)},e.prototype.type=function(){return"value"},e.prototype.valueForm=function(t){return void 0===t?this._valueForm:this.copy(this._context,this._owner,this._hostUri,this._nodeUri,this._laneUri,this._prio,this._rate,this._body,this._flags,this._observers,t,this._state0)},e.prototype.get=function(){return this._model.get().coerce(this._valueForm)},e.prototype.set=function(t){var e=this._valueForm.mold(t);this._model.set(e)},e.prototype.setState=function(t){this._model.setState(t)},e.prototype.observe=function(e){return t.prototype.observe.call(this,e)},e.prototype.willSet=function(t){return this.observe({willSet:t})},e.prototype.didSet=function(t){return this.observe({didSet:t})},e.prototype.valueWillSet=function(t){for(var e,i=this._observers,o=i?i.length:0,n=0;n<o;n+=1){var r=i[n];if(r.willSet){void 0===e&&(e=t.coerce(this._valueForm));var s=r.willSet(e,this);void 0!==s&&(e=s,t=this._valueForm.mold(e))}}return t},e.prototype.valueDidSet=function(t,e){for(var i,o,n=this._observers,r=n?n.length:0,s=0;s<r;s+=1){var h=n[s];h.didSet&&(void 0===i&&(i=t.coerce(this._valueForm)),void 0===o&&(o=e.coerce(this._valueForm)),h.didSet(i,o,this))}this.invalidate(),this.reconcile(0)},e.prototype.initialState=function(t){return void 0===t?this._state0:this.copy(this._context,this._owner,this._hostUri,this._nodeUri,this._laneUri,this._prio,this._rate,this._body,this._flags,this._observers,this._valueForm,t)},e.prototype.didAliasModel=function(){this.onLinkedResponse(),this.valueDidSet(this._model.get(),o.Value.absent()),this.onSyncedResponse()},e.prototype.open=function(){var t=this._laneUri;if(t.isEmpty())throw new Error("no lane");var e=this._nodeUri;if(e.isEmpty())throw new Error("no node");var i=this._hostUri;i.isEmpty()&&(i=e.endpoint(),e=i.unresolve(e));var o=this._context.getDownlink(i,e,t);if(o){if(!(o instanceof R))throw new Error("downlink type mismatch");o.addDownlink(this),this._model=o,setTimeout(this.didAliasModel.bind(this))}else(o=new R(this._context,i,e,t,this._prio,this._rate,this._body,this._state0)).addDownlink(this),this._context.openDownlink(o),this._model=o;return this._owner&&this._owner.addDownlink(this),this},e.prototype.input=function(){return this._input},e.prototype.bindInput=function(t){null!==this._input&&this._input.unbindOutput(this),this._input=t,null!==this._input&&this._input.bindOutput(this)},e.prototype.unbindInput=function(){null!==this._input&&this._input.unbindOutput(this),this._input=null},e.prototype.disconnectInputs=function(){var t=this._input;null!==t&&(t.unbindOutput(this),this._input=null,t.disconnectInputs())},e.prototype.outputIterator=function(){return null!==this._outputs?r.Cursor.array(this._outputs):r.Cursor.empty()},e.prototype.bindOutput=function(t){for(var e=this._outputs,i=null!==e?e.length:0,o=new Array(i+1),n=0;n<i;n+=1)o[n]=e[n];o[i]=t,this._outputs=o},e.prototype.unbindOutput=function(t){for(var e=this._outputs,i=null!==e?e.length:0,o=0;o<i;o+=1)if(e[o]===t){if(i>1){for(var n=new Array(i-1),r=0;r<o;r+=1)n[r]=e[r];for(r=o;r<i-1;r+=1)n[r]=e[r+1];this._outputs=n}else this._outputs=null;break}},e.prototype.unbindOutputs=function(){var t=this._outputs;if(null!==t){this._outputs=null;for(var e=0,i=t.length;e<i;e+=1)t[e].unbindInput()}},e.prototype.disconnectOutputs=function(){var t=this._outputs;if(null!==t){this._outputs=null;for(var e=0,i=t.length;e<i;e+=1){var o=t[e];o.unbindInput(),o.disconnectOutputs()}}},e.prototype.invalidateOutput=function(){this.invalidate()},e.prototype.invalidateInput=function(){this.invalidate()},e.prototype.invalidate=function(){if(this._version>=0){this.willInvalidate(),this._version=-1,this.onInvalidate();for(var t=null!==this._outputs?this._outputs.length:0,e=0;e<t;e+=1)this._outputs[e].invalidateOutput();this.didInvalidate()}},e.prototype.reconcileOutput=function(t){this.reconcile(t)},e.prototype.reconcileInput=function(t){this.reconcile(t)},e.prototype.reconcile=function(t){if(this._version<0){this.willReconcile(t),this._version=t,null!==this._input&&this._input.reconcileInput(t),this.onReconcile(t);for(var e=null!==this._outputs?this._outputs.length:0,i=0;i<e;i+=1)this._outputs[i].reconcileOutput(t);this.didReconcile(t)}},e.prototype.willInvalidate=function(){},e.prototype.onInvalidate=function(){},e.prototype.didInvalidate=function(){},e.prototype.willReconcile=function(t){},e.prototype.onReconcile=function(t){if(null!==this._input){var e=this._input.get();void 0!==e&&this.set(e)}},e.prototype.didReconcile=function(t){},e.prototype.memoize=function(){return this},e.prototype.map=function(t){var e=new s.MapValueCombinator(t);return e.bindInput(this),e},e.prototype.watch=function(t){return new s.WatchValueCombinator(t).bindInput(this),this},e}(y),F=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return a(e,t),e}(h.AbstractRecordOutlet),C=function(t){function e(e){var i=t.call(this)||this;return i._downlink=e,i}return a(e,t),Object.defineProperty(e.prototype,"downlink",{get:function(){return this._downlink},enumerable:!0,configurable:!0}),e.prototype.isEmpty=function(){return this._downlink.isEmpty()},e.prototype.isArray=function(){return!0},e.prototype.isObject=function(){return this._downlink.isEmpty()},Object.defineProperty(e.prototype,"length",{get:function(){return this._downlink.length},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"size",{get:function(){return this._downlink.length},enumerable:!0,configurable:!0}),e.prototype.has=function(t){return!1},e.prototype.get=function(t){return void 0===t?this:o.Value.absent()},e.prototype.getAttr=function(t){return o.Value.absent()},e.prototype.getSlot=function(t){return o.Value.absent()},e.prototype.getItem=function(t){t instanceof o.Num&&(t=t.value);var e=this._downlink.length;return t<0&&(t=e+t),(t=Math.min(Math.max(0,t),e-1))>=0?this._downlink.get(t):o.Item.absent()},e.prototype.set=function(t,e){throw new Error("unsupported")},e.prototype.setAttr=function(t,e){throw new Error("unsupported")},e.prototype.setSlot=function(t,e){throw new Error("unsupported")},e.prototype.setItem=function(t,e){t instanceof o.Num&&(t=t.value);var i=this._downlink.length;return t<0&&(t=i+t),(t=Math.min(Math.max(0,t),i-1))>=0&&this._downlink.set(t,o.Value.fromAny(e)),this},e.prototype.push=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];return this._downlink.push.apply(this._downlink,arguments)},e.prototype.splice=function(t,e){for(var i=[],o=2;o<arguments.length;o++)i[o-2]=arguments[o];return this._downlink.splice.apply(this._downlink,arguments)},e.prototype.delete=function(t){return o.Item.absent()},e.prototype.clear=function(){this._downlink.clear()},e.prototype.forEach=function(t,e){return this._downlink.forEach((function(i,o){return t.call(e,i,o)}))},e.prototype.keyIterator=function(){return r.Cursor.empty()},e}(F),S=function(t){function e(e){var i=t.call(this)||this;return i._downlink=e,i._downlink.observe(i),i}return a(e,t),Object.defineProperty(e.prototype,"downlink",{get:function(){return this._downlink},enumerable:!0,configurable:!0}),e.prototype.isEmpty=function(){return this._downlink.isEmpty()},e.prototype.isArray=function(){return this._downlink.isEmpty()},e.prototype.isObject=function(){return!0},Object.defineProperty(e.prototype,"length",{get:function(){return this._downlink.size},enumerable:!0,configurable:!0}),e.prototype.has=function(t){return this._downlink.has(t)},e.prototype.get=function(t){return void 0===t?this:this._downlink.get(t)},e.prototype.getAttr=function(t){return o.Value.absent()},e.prototype.getSlot=function(t){return this.get(t)},e.prototype.getItem=function(t){t instanceof o.Num&&(t=t.value);var e=this._downlink.size;if(t<0&&(t=e+t),(t=Math.min(Math.max(0,t),e-1))>=0){var i=this._downlink.getEntry(t);return o.Slot.of(i[0],i[1])}return o.Item.absent()},e.prototype.set=function(t,e){return this._downlink.set(t,e),this},e.prototype.setAttr=function(t,e){throw new Error("unsupported")},e.prototype.setSlot=function(t,e){return this.set(t,e)},e.prototype.setItem=function(t,e){throw new Error("unsupported")},e.prototype.push=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];throw new Error("unsupported")},e.prototype.splice=function(t,e){for(var i=[],o=2;o<arguments.length;o++)i[o-2]=arguments[o];throw new Error("unsupported")},e.prototype.delete=function(t){t=o.Value.fromAny(t);var e=this._downlink.get(t);return this._downlink.delete(t)?o.Slot.of(t,e):o.Item.absent()},e.prototype.clear=function(){this._downlink.clear()},e.prototype.forEach=function(t,e){var i=0;return this._downlink.forEach((function(n,r){var s=t.call(e,o.Slot.of(n,r),i);return i+=1,s}))},e.prototype.keyIterator=function(){return this._downlink.keys()},e.prototype.didUpdate=function(t,e,i){this.invalidateInputKey(t,0),this.reconcileInput(0)},e.prototype.didRemove=function(t,e){this.invalidateInputKey(t,1),this.reconcileInput(0)},e.prototype.didDrop=function(t){},e.prototype.didTake=function(t){},e.prototype.didClear=function(){},e}(F),A=function(t){function e(e){var i=t.call(this)||this;return i._downlink=e,i._downlink.observe(i),i}return a(e,t),Object.defineProperty(e.prototype,"downlink",{get:function(){return this._downlink},enumerable:!0,configurable:!0}),e.prototype.isEmpty=function(){var t=this._downlink.get();return t instanceof o.Record?t.isEmpty():!t.isDefined()},e.prototype.isArray=function(){var t=this._downlink.get();return!(t instanceof o.Record)||t.isArray()},e.prototype.isObject=function(){var t=this._downlink.get();return t instanceof o.Record?t.isObject():!t.isDefined()},Object.defineProperty(e.prototype,"length",{get:function(){var t=this._downlink.get();return t instanceof o.Record?t.length:t.isDefined()?1:0},enumerable:!0,configurable:!0}),e.prototype.has=function(t){var e=this._downlink.get();return e instanceof o.Record&&e.has(t)},e.prototype.get=function(t){if(void 0===t)return this;var e=this._downlink.get();return e instanceof o.Record?e.get(t):o.Value.absent()},e.prototype.getAttr=function(t){var e=this._downlink.get();return e instanceof o.Record?e.getAttr(t):o.Value.absent()},e.prototype.getSlot=function(t){var e=this._downlink.get();return e instanceof o.Record?e.getSlot(t):o.Value.absent()},e.prototype.getField=function(t){var e=this._downlink.get();return e instanceof o.Record?e.getField(t):void 0},e.prototype.getItem=function(t){var e=this._downlink.get();return e instanceof o.Record?e.getItem(t):e},e.prototype.set=function(t,e){var i=this._downlink.get();if(!(i instanceof o.Record))throw new Error("unsupported");return i.set(t,e),this},e.prototype.setAttr=function(t,e){var i=this._downlink.get();if(!(i instanceof o.Record))throw new Error("unsupported");return i.setAttr(t,e),this},e.prototype.setSlot=function(t,e){var i=this._downlink.get();if(!(i instanceof o.Record))throw new Error("unsupported");return i.setSlot(t,e),this},e.prototype.setItem=function(t,e){var i=this._downlink.get();return i instanceof o.Record?i.setItem(t,e):this._downlink.set(o.Item.fromAny(e).toValue()),this},e.prototype.push=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];var i=this._downlink.get();if(i instanceof o.Record)return i.push.apply(i,arguments);throw new Error("unsupported")},e.prototype.splice=function(t,e){for(var i=[],n=2;n<arguments.length;n++)i[n-2]=arguments[n];var r=this._downlink.get();if(r instanceof o.Record)return r.splice.apply(r,arguments);throw new Error("unsupported")},e.prototype.delete=function(t){var e=this._downlink.get();return e instanceof o.Record?e.delete(t):o.Value.absent()},e.prototype.clear=function(){var t=this._downlink.get();if(!(t instanceof o.Record))throw new Error("unsupported");t.clear()},e.prototype.forEach=function(t,e){return this._downlink.get().forEach(t,e)},e.prototype.keyIterator=function(){if(this._downlink.get()instanceof o.Record)throw new Error;return r.Cursor.empty()},e.prototype.didSet=function(t,e){this.invalidateInput(),this.reconcileInput(0)},e}(F),V=function(t){function e(e){var i=t.call(this)||this;return i.warp=e,i}return a(e,t),e.prototype.transmute=function(t){if("link"===t.tag()){var e=new I(this.warp,t);return e.compile(),e}return t},e}(h.Transmuter),I=function(t){function e(e,i){var o=t.call(this,i)||this;return o.hostUri=o.inoutlet(),o.nodeUri=o.inoutlet(),o.laneUri=o.inoutlet(),o.prio=o.inoutlet(),o.rate=o.inoutlet(),o.bodyValue=o.inoutlet(),o.type=o.inoutlet(),o.warp=e,o}return a(e,t),e.prototype.getOutput=function(t){if((t=this.outlet(t))===this.state){if(this.downlink instanceof E)return this.downlink.get();if(this.downlinkRecord)return this.downlinkRecord}},e.prototype.onReconcile=function(t){var e=this.castInput(this.hostUri,o.Form.forString()),i=this.castInput(this.nodeUri,o.Form.forString()),n=this.castInput(this.laneUri,o.Form.forString()),r=this.castInput(this.prio,o.Form.forNumber(),0),s=this.castInput(this.rate,o.Form.forNumber(),0),h=this.getInput(this.bodyValue),l=this.castInput(this.type,o.Form.forString(),void 0);if(e!==this.inputHostUri||i!==this.inputNodeUri||n!==this.inputLaneUri||r!==this.inputPrio||s!==this.inputRate||(void 0===h?void 0!==this.inputBody:!h.equals(this.inputBody))||l!==this.inputType){this.downlink&&(this.downlink.close(),this.downlink=void 0,this.downlinkRecord=void 0),this.inputHostUri=e,this.inputNodeUri=i,this.inputLaneUri=n,this.inputPrio=r,this.inputRate=s,this.inputBody=h,this.inputType=l;var u=this.warp||L;if("map"===l){var a=u.downlinkMap();void 0!==e&&(a=a.hostUri(e)),void 0!==i&&(a=a.nodeUri(i)),void 0!==n&&(a=a.laneUri(n)),0!==r&&(a=a.prio(r)),0!==s&&(a=a.rate(s)),void 0!==h&&(a=a.body(h)),a=a.open(),this.state=a,this.downlink=a,this.downlinkRecord=new S(a)}else if("value"===l){a=u.downlinkValue();void 0!==e&&(a=a.hostUri(e)),void 0!==i&&(a=a.nodeUri(i)),void 0!==n&&(a=a.laneUri(n)),void 0!==r&&(a=a.prio(r)),void 0!==s&&(a=a.rate(s)),void 0!==h&&(a=a.body(h)),a=a.open(),this.state=a,this.downlink=a}}},e.transmuter=function(t){return void 0===t?(e._transmuter||(e._transmuter=new V),e._transmuter):new V(t)},p([s.Inout],e.prototype,"hostUri",void 0),p([s.Inout],e.prototype,"nodeUri",void 0),p([s.Inout],e.prototype,"laneUri",void 0),p([s.Inout],e.prototype,"prio",void 0),p([s.Inout],e.prototype,"rate",void 0),p([s.Inout("body")],e.prototype,"bodyValue",void 0),p([s.Inout],e.prototype,"type",void 0),p([s.Out],e.prototype,"state",void 0),e}(h.AbstractRecordStreamlet),x=function(){function t(t){this._context=t,this._host=void 0,this._downlinks=[],this._observers=null}return t.prototype.isConnected=function(){return!!this._host&&this._host.isConnected()},t.prototype.isAuthenticated=function(){return!!this._host&&this._host.isAuthenticated()},t.prototype.session=function(){return this._host?this._host.session():o.Value.absent()},t.prototype.authenticate=function(t){this._context.authenticate(this.hostUri(),t)},t.prototype.addDownlink=function(t){0===this._downlinks.length&&this.open(),this._downlinks.push(t)},t.prototype.removeDownlink=function(t){var e=this._downlinks.indexOf(t);e>=0&&(this._downlinks.splice(e,1),0===this._downlinks.length&&this.close())},t.prototype.open=function(){this._context.openRef(this)},t.prototype.close=function(){this._context.closeRef(this)},t.prototype.closeUp=function(){var t=this._downlinks;this._downlinks=[];for(var e=0,i=t.length;e<i;e+=1)t[e].close()},t.prototype.observe=function(t){for(var e=this._observers,i=e?e.length:0,o=new Array(i+1),n=0;n<i;n+=1)o[n]=e[n];return o[i]=t,this._observers=o,this},t.prototype.unobserve=function(t){for(var e=this._observers,i=e?e.length:0,o=0;o<i;o+=1){var n=e[o],r=n===t;if(!r)for(var s in n)if(n[s]===t){r=!0;break}if(r){if(i>1){for(var h=new Array(i-1),l=0;l<o;l+=1)h[l]=e[l];for(l=o+1;l<i;l+=1)h[l-1]=e[l];this._observers=h}else this._observers=null;break}}return this},t.prototype.didConnect=function(t){return this.observe({didConnect:t})},t.prototype.didAuthenticate=function(t){return this.observe({didAuthenticate:t})},t.prototype.didDeauthenticate=function(t){return this.observe({didDeauthenticate:t})},t.prototype.didDisconnect=function(t){return this.observe({didDisconnect:t})},t.prototype.didFail=function(t){return this.observe({didFail:t})},t.prototype.hostDidConnect=function(t){this._host=t;for(var e=this._observers,i=e?e.length:0,o=0;o<i;o+=1){var n=e[o];n.didConnect&&n.didConnect(t,this)}},t.prototype.hostDidAuthenticate=function(t,e){for(var i=this._observers,o=i?i.length:0,n=0;n<o;n+=1){var r=i[n];r.didAuthenticate&&r.didAuthenticate(t,e,this)}},t.prototype.hostDidDeauthenticate=function(t,e){for(var i=this._observers,o=i?i.length:0,n=0;n<o;n+=1){var r=i[n];r.didDeauthenticate&&r.didDeauthenticate(t,e,this)}},t.prototype.hostDidDisconnect=function(t){this._host=void 0;for(var e=this._observers,i=e?e.length:0,o=0;o<i;o+=1){var n=e[o];n.didDisconnect&&n.didDisconnect(t,this)}},t.prototype.hostDidFail=function(t,e){for(var i=this._observers,o=i?i.length:0,n=0;n<o;n+=1){var r=i[n];r.didFail&&r.didFail(t,e,this)}},t}(),T=function(t){function e(e,i,o,n){var r=t.call(this,e)||this;return r._hostUri=i,r._nodeUri=o,r._laneUri=n,r}return a(e,t),e.prototype.hostUri=function(){return this._hostUri},e.prototype.nodeUri=function(){return this._nodeUri},e.prototype.laneUri=function(){return this._laneUri},e.prototype.hostRef=function(t){return t=i.Uri.fromAny(t),new M(this._context,t)},e.prototype.nodeRef=function(t){return t=i.Uri.fromAny(t),new O(this._context,this._hostUri,t)},e.prototype.laneRef=function(t){return t=i.Uri.fromAny(t),new e(this._context,this._hostUri,this._nodeUri,t)},e.prototype.downlink=function(t){return new k(this._context,this,t,this._hostUri,this._nodeUri,this._laneUri)},e.prototype.downlinkList=function(t){return new b(this._context,this,t,this._hostUri,this._nodeUri,this._laneUri)},e.prototype.downlinkMap=function(t){return new D(this._context,this,t,this._hostUri,this._nodeUri,this._laneUri)},e.prototype.downlinkValue=function(t){return new E(this._context,this,t,this._hostUri,this._nodeUri,this._laneUri)},e.prototype.command=function(t){this._context.command(this._hostUri,this._nodeUri,this._laneUri,t)},e}(x),O=function(t){function e(e,i,o){var n=t.call(this,e)||this;return n._hostUri=i,n._nodeUri=o,n}return a(e,t),e.prototype.hostUri=function(){return this._hostUri},e.prototype.nodeUri=function(){return this._nodeUri},e.prototype.hostRef=function(t){return t=i.Uri.fromAny(t),new M(this._context,t)},e.prototype.nodeRef=function(t){return t=i.Uri.fromAny(t),new e(this._context,this._hostUri,t)},e.prototype.laneRef=function(t){return t=i.Uri.fromAny(t),new T(this._context,this._hostUri,this._nodeUri,t)},e.prototype.downlink=function(t){return new k(this._context,this,t,this._hostUri,this._nodeUri)},e.prototype.downlinkList=function(t){return new b(this._context,this,t,this._hostUri,this._nodeUri)},e.prototype.downlinkMap=function(t){return new D(this._context,this,t,this._hostUri,this._nodeUri)},e.prototype.downlinkValue=function(t){return new E(this._context,this,t,this._hostUri,this._nodeUri)},e.prototype.command=function(t,e){this._context.command(this._hostUri,this._nodeUri,t,e)},e}(x),M=function(t){function e(e,i){var o=t.call(this,e)||this;return o._hostUri=i,o}return a(e,t),e.prototype.hostUri=function(){return this._hostUri},e.prototype.hostRef=function(t){return t=i.Uri.fromAny(t),new e(this._context,t)},e.prototype.nodeRef=function(t){return t=i.Uri.fromAny(t),new O(this._context,this._hostUri,t)},e.prototype.laneRef=function(t,e){return t=i.Uri.fromAny(t),e=i.Uri.fromAny(e),new T(this._context,this._hostUri,t,e)},e.prototype.downlink=function(t){return new k(this._context,this,t,this._hostUri)},e.prototype.downlinkList=function(t){return new b(this._context,this,t,this._hostUri)},e.prototype.downlinkMap=function(t){return new D(this._context,this,t,this._hostUri)},e.prototype.downlinkValue=function(t){return new E(this._context,this,t,this._hostUri)},e.prototype.command=function(t,e,i){this._context.command(this._hostUri,t,e,i)},e}(x),W=function(){function t(t){void 0===t&&(t={}),void 0===t.keepOnline&&(t.keepOnline=!0),this._options=t,this._hosts=new e.BTree,this._downlinks=new e.BTree,this._downlinkCount=0,this._refs=[],this._online=!0,this._observers=null,this.onOnline=this.onOnline.bind(this),this.onOffline=this.onOffline.bind(this),this.watchOnline(!!t.keepOnline)}return t.prototype.isOnline=function(t){return void 0===t?this._online:(this._online!==t&&(this._online=t,t&&this._hosts.forEach((function(t,e){e.open()}),this)),this)},t.prototype.keepOnline=function(t){return void 0===t?!!this._options.keepOnline:(this._options.keepOnline!==t&&(this._options.keepOnline=t,this.watchOnline(t)),this)},t.prototype.watchOnline=function(t){"object"==typeof window&&(t?(window.addEventListener("online",this.onOnline),window.addEventListener("offline",this.onOffline)):(window.removeEventListener("online",this.onOnline),window.removeEventListener("offline",this.onOffline)))},t.prototype.onOnline=function(t){this.isOnline(!0)},t.prototype.onOffline=function(t){this.isOnline(!1)},t.prototype.getHost=function(t){return t=i.Uri.fromAny(t),this._hosts.get(t)},t.prototype.openHost=function(t){t=i.Uri.fromAny(t);var e=this._hosts.get(t);return e||(e=new v(this,t,this._options),this._hosts.set(t,e)),e},t.prototype.closeHost=function(t){this._hosts.get(t.hostUri())&&(this._hosts.delete(t.hostUri()),t.closeUp())},t.prototype.getDownlink=function(t,e,i){var o=this._downlinks.get(t);if(o){var n=o.get(e);if(n)return n.get(i)}},t.prototype.openDownlink=function(t){var i=t.hostUri(),o=t.nodeUri(),n=t.laneUri(),r=this._downlinks.get(i);r||(r=new e.BTree,this._downlinks.set(i,r));var s=r.get(o);if(s||(s=new e.BTree,r.set(o,s)),s.has(n))throw new Error("duplicate downlink");s.set(n,t),this._downlinkCount+=1,this.openHost(i).openDownlink(t)},t.prototype.unlinkDownlink=function(t){var e=t.hostUri(),i=this.getHost(e);i&&i.unlinkDownlink(t)},t.prototype.closeDownlink=function(t){var e=t.hostUri(),i=t.nodeUri(),o=t.laneUri(),n=this._downlinks.get(e);if(n){var r=n.get(i);if(r&&r.get(o)){this._downlinkCount-=1,r.delete(o),r.isEmpty()&&(n.delete(i),n.isEmpty()&&this._downlinks.delete(e));var s=this.getHost(e);s&&s.closeDownlink(t)}}},t.prototype.downlink=function(t){return new k(this,void 0,t)},t.prototype.downlinkList=function(t){return new b(this,void 0,t)},t.prototype.downlinkMap=function(t){return new D(this,void 0,t)},t.prototype.downlinkValue=function(t){return new E(this,void 0,t)},t.prototype.openRef=function(t){this._refs.push(t)},t.prototype.closeRef=function(t){var e=this._refs.indexOf(t);e>=0&&(this._refs.splice(e,1),t.closeUp())},t.prototype.hostRef=function(t){return t=i.Uri.fromAny(t),new M(this,t)},t.prototype.nodeRef=function(t,e){return t=i.Uri.fromAny(t),void 0===e?(t=(e=t).endpoint(),e=t.unresolve(e)):e=i.Uri.fromAny(e),new O(this,t,e)},t.prototype.laneRef=function(t,e,o){return t=i.Uri.fromAny(t),e=i.Uri.fromAny(e),void 0===o?(o=e,t=(e=t).endpoint(),e=t.unresolve(e)):o=i.Uri.fromAny(o),new T(this,t,e,o)},t.prototype.authenticate=function(t,e){t=i.Uri.fromAny(t),e=o.Value.fromAny(e),this.openHost(t).authenticate(e)},t.prototype.command=function(t,e,n,r){t=i.Uri.fromAny(t),e=i.Uri.fromAny(e),3===arguments.length?(r=n,n=e,t=(e=t).endpoint(),e=t.unresolve(e)):n=i.Uri.fromAny(n),r=o.Value.fromAny(r);var s=this.openHost(t);s.command(e,n,r)},t.prototype.close=function(){var t=this._refs;this._refs=[];for(var e=0;e<t.length;e+=1)t[e].closeUp();var i=this._downlinks.clone();this._downlinks.clear(),this._downlinkCount=0,i.forEach((function(t,e){e.forEach((function(e,i){i.forEach((function(e,i){i.closeUp();var o=this.getHost(t);o&&o.closeDownlink(i)}),this)}),this)}),this);var o=this._hosts.clone();this._hosts.clear(),o.forEach((function(t,e){e.closeUp()}),this)},t.prototype.observe=function(t){for(var e=this._observers,i=e?e.length:0,o=new Array(i+1),n=0;n<i;n+=1)o[n]=e[n];return o[i]=t,this._observers=o,this},t.prototype.unobserve=function(t){for(var e=this._observers,i=e?e.length:0,o=0;o<i;o+=1){var n=e[o],r=n===t;if(!r)for(var s in n)if(n[s]===t){r=!0;break}if(r){if(i>1){for(var h=new Array(i-1),l=0;l<o;l+=1)h[l]=e[l];for(l=o+1;l<i;l+=1)h[l-1]=e[l];this._observers=h}else this._observers=null;break}}return this},t.prototype.didConnect=function(t){return this.observe({didConnect:t})},t.prototype.didAuthenticate=function(t){return this.observe({didAuthenticate:t})},t.prototype.didDeauthenticate=function(t){return this.observe({didDeauthenticate:t})},t.prototype.didDisconnect=function(t){return this.observe({didDisconnect:t})},t.prototype.didFail=function(t){return this.observe({didFail:t})},t.prototype.hostDidConnect=function(t){for(var e=this._observers,i=e?e.length:0,o=0;o<i;o+=1){var n=e[o];n.didConnect&&n.didConnect(t,this)}for(o=0;o<this._refs.length;o+=1){var r=this._refs[o];r.hostUri().equals(t.hostUri())&&r.hostDidConnect(t)}},t.prototype.hostDidAuthenticate=function(t,e){for(var i=this._observers,o=i?i.length:0,n=0;n<o;n+=1){var r=i[n];r.didAuthenticate&&r.didAuthenticate(t,e,this)}for(n=0;n<this._refs.length;n+=1){var s=this._refs[n];s.hostUri().equals(e.hostUri())&&s.hostDidAuthenticate(t,e)}},t.prototype.hostDidDeauthenticate=function(t,e){for(var i=this._observers,o=i?i.length:0,n=0;n<o;n+=1){var r=i[n];r.didDeauthenticate&&r.didDeauthenticate(t,e,this)}for(n=0;n<this._refs.length;n+=1){var s=this._refs[n];s.hostUri().equals(e.hostUri())&&s.hostDidDeauthenticate(t,e)}},t.prototype.hostDidDisconnect=function(t){for(var e=this._observers,i=e?e.length:0,o=0;o<i;o+=1){var n=e[o];n.didDisconnect&&n.didDisconnect(t,this)}for(o=0;o<this._refs.length;o+=1){var r=this._refs[o];r.hostUri().equals(t.hostUri())&&r.hostDidDisconnect(t)}},t.prototype.hostDidFail=function(t,e){for(var i=this._observers,o=i?i.length:0,n=0;n<o;n+=1){var r=i[n];r.didFail&&r.didFail(t,e,this)}for(n=0;n<this._refs.length;n+=1){var s=this._refs[n];s.hostUri().equals(e.hostUri())&&s.hostDidFail(t,e)}},t}(),L=new W,q=L.isOnline.bind(L),K=L.keepOnline.bind(L),j=L.downlink.bind(L),B=L.downlinkList.bind(L),P=L.downlinkMap.bind(L),H=L.downlinkValue.bind(L),z=L.hostRef.bind(L),N=L.nodeRef.bind(L),G=L.laneRef.bind(L),J=L.authenticate.bind(L),Q=L.command.bind(L);t.BaseRef=x,t.Downlink=y,t.DownlinkModel=_,t.DownlinkRecord=F,t.DownlinkStreamlet=I,t.DownlinkTransmuter=V,t.EventDownlink=k,t.EventDownlinkModel=w,t.Host=l,t.HostRef=M,t.LaneRef=T,t.ListDownlink=b,t.ListDownlinkModel=g,t.ListDownlinkRecord=C,t.MapDownlink=D,t.MapDownlinkModel=U,t.MapDownlinkRecord=S,t.NodeRef=O,t.RemoteHost=f,t.ValueDownlink=E,t.ValueDownlinkModel=R,t.ValueDownlinkRecord=A,t.WarpClient=W,t.WebSocketHost=v,t.authenticate=J,t.client=L,t.command=Q,t.downlink=j,t.downlinkList=B,t.downlinkMap=P,t.downlinkValue=H,t.hostRef=z,t.isOnline=q,t.keepOnline=K,t.laneRef=G,t.nodeRef=N,Object.defineProperty(t,"__esModule",{value:!0})}));
//# sourceMappingURL=swim-client.min.js.map