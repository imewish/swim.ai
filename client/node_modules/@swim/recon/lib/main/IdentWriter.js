import { __extends } from "tslib";
import { WriterException, Writer, Utf8 } from "@swim/codec";
import { Recon } from "./Recon";
var IdentWriter = (function (_super) {
    __extends(IdentWriter, _super);
    function IdentWriter(ident, index) {
        var _this = _super.call(this) || this;
        _this._ident = ident;
        _this._index = index;
        return _this;
    }
    IdentWriter.prototype.pull = function (output) {
        return IdentWriter.write(output, this._ident, this._index);
    };
    IdentWriter.sizeOf = function (ident) {
        return Utf8.sizeOf(ident);
    };
    IdentWriter.write = function (output, ident, index) {
        if (index === void 0) { index = 0; }
        var c;
        var length = ident.length;
        if (length === 0) {
            return Writer.error(new WriterException("empty identifier"));
        }
        if (index === 0 && output.isCont()) {
            c = ident.codePointAt(0);
            if (c === void 0) {
                c = ident.charCodeAt(0);
            }
            if (Recon.isIdentStartChar(c)) {
                output = output.write(c);
                index = ident.offsetByCodePoints(0, 1);
            }
        }
        while (index < length && output.isCont()) {
            c = ident.codePointAt(index);
            if (c === void 0) {
                c = ident.charCodeAt(index);
            }
            if (Recon.isIdentChar(c)) {
                output = output.write(c);
                index = ident.offsetByCodePoints(index, 1);
            }
            else {
                return Writer.error(new WriterException("invalid identifier"));
            }
        }
        if (index >= length) {
            return Writer.done();
        }
        if (output.isDone()) {
            return Writer.error(new WriterException("truncated"));
        }
        else if (output.isError()) {
            return Writer.error(output.trap());
        }
        return new IdentWriter(ident, index);
    };
    return IdentWriter;
}(Writer));
export { IdentWriter };
//# sourceMappingURL=IdentWriter.js.map