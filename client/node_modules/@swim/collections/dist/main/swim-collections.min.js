// swim-collections-3.10.2; copyright 2015-2020 SWIM.AI inc.
!function(t,e){"object"==typeof exports&&"undefined"!=typeof module?e(exports,require("@swim/util")):"function"==typeof define&&define.amd?define(["exports","@swim/util"],e):e((t=t||self).swim=t.swim||{},t.swim)}(this,(function(t,e){"use strict";
/*! *****************************************************************************
    Copyright (c) Microsoft Corporation. All rights reserved.
    Licensed under the Apache License, Version 2.0 (the "License"); you may not use
    this file except in compliance with the License. You may obtain a copy of the
    License at http://www.apache.org/licenses/LICENSE-2.0

    THIS CODE IS PROVIDED ON AN *AS IS* BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY
    KIND, EITHER EXPRESS OR IMPLIED, INCLUDING WITHOUT LIMITATION ANY IMPLIED
    WARRANTIES OR CONDITIONS OF TITLE, FITNESS FOR A PARTICULAR PURPOSE,
    MERCHANTABLITY OR NON-INFRINGEMENT.

    See the Apache Version 2.0 License for specific language governing permissions
    and limitations under the License.
    ***************************************************************************** */var r=function(t,e){return(r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var r in e)e.hasOwnProperty(r)&&(t[r]=e[r])})(t,e)};function o(t,e){function o(){this.constructor=t}r(t,e),t.prototype=null===e?Object.create(e):(o.prototype=e.prototype,new o)}var i=function(t){function e(e){var r=t.call(this)||this;return r._cursor=e,r}return o(e,t),e.prototype.isEmpty=function(){return this._cursor.isEmpty()},e.prototype.head=function(){return this._cursor.head()[0]},e.prototype.step=function(){this._cursor.step()},e.prototype.skip=function(t){this._cursor.skip(t)},e.prototype.hasNext=function(){return this._cursor.hasNext()},e.prototype.nextIndex=function(){return this._cursor.nextIndex()},e.prototype.next=function(){var t=this._cursor.next(),e=t.value,r=t.done;return{value:e&&e[0],done:r}},e.prototype.hasPrevious=function(){return this._cursor.hasPrevious()},e.prototype.previousIndex=function(){return this._cursor.previousIndex()},e.prototype.previous=function(){var t=this._cursor.previous(),e=t.value,r=t.done;return{value:e&&e[0],done:r}},e.prototype.delete=function(){this._cursor.delete()},e}(e.Cursor),n=function(t){function e(e){var r=t.call(this)||this;return r._cursor=e,r}return o(e,t),e.prototype.isEmpty=function(){return this._cursor.isEmpty()},e.prototype.head=function(){return this._cursor.head()[1]},e.prototype.step=function(){this._cursor.step()},e.prototype.skip=function(t){this._cursor.skip(t)},e.prototype.hasNext=function(){return this._cursor.hasNext()},e.prototype.nextIndex=function(){return this._cursor.nextIndex()},e.prototype.next=function(){var t=this._cursor.next(),e=t.value,r=t.done;return{value:e&&e[1],done:r}},e.prototype.hasPrevious=function(){return this._cursor.hasPrevious()},e.prototype.previousIndex=function(){return this._cursor.previousIndex()},e.prototype.previous=function(){var t=this._cursor.previous(),e=t.value,r=t.done;return{value:e&&e[1],done:r}},e.prototype.delete=function(){this._cursor.delete()},e}(e.Cursor),s=function(t){function e(e,r,o,i){void 0===r&&(r=0),void 0===o&&(o=0);var n=t.call(this)||this;return n._pages=e,n._index=r,n._pageIndex=o,n._pageCursor=i,n}return o(e,t),e.prototype.isEmpty=function(){for(;;)if(this._pageCursor){if(!this._pageCursor.isEmpty())return!1;this._pageCursor=void 0}else{if(!(this._pageIndex<this._pages.length))return this._pageIndex=this._pages.length,!0;this._pageCursor=this.pageCursor(this._pages[this._pageIndex]),this._pageIndex+=1}},e.prototype.head=function(){for(;;)if(this._pageCursor){if(!this._pageCursor.isEmpty())return this._pageCursor.head();this._pageCursor=void 0}else{if(!(this._pageIndex<this._pages.length))throw this._pageIndex=this._pages.length,new Error("empty");this._pageCursor=this.pageCursor(this._pages[this._pageIndex]),this._pageIndex+=1}},e.prototype.step=function(){for(;;)if(this._pageCursor){if(!this._pageCursor.isEmpty())return void(this._index+=1);this._pageCursor=void 0}else{if(!(this._pageIndex<this._pages.length))throw this._pageIndex=this._pages.length,new Error("empty");this._pageCursor=this.pageCursor(this._pages[this._pageIndex]),this._pageIndex+=1}},e.prototype.skip=function(t){for(;t>0;)if(this._pageCursor)this._pageCursor.hasNext()?(this._index+=1,t-=1,this._pageCursor.next()):this._pageCursor=void 0;else{if(!(this._pageIndex<this._pages.length))break;var e=this._pages[this._pageIndex],r=this.pageSize(e);if(this._pageIndex+=1,r<t){this._pageCursor=this.pageCursor(e),t>0&&(this._index+=t,this._pageCursor.skip(t),t=0);break}this._index+=r,t-=r}},e.prototype.hasNext=function(){for(;;)if(this._pageCursor){if(this._pageCursor.hasNext())return!0;this._pageCursor=void 0}else{if(!(this._pageIndex<this._pages.length))return this._pageIndex=this._pages.length,!1;this._pageCursor=this.pageCursor(this._pages[this._pageIndex]),this._pageIndex+=1}},e.prototype.nextIndex=function(){return this._index},e.prototype.next=function(){for(;;)if(this._pageCursor){if(this._pageCursor.hasNext())return this._index+=1,this._pageCursor.next();this._pageCursor=void 0}else{if(!(this._pageIndex<this._pages.length))return this._pageIndex=this._pages.length,{done:!0};this._pageCursor=this.pageCursor(this._pages[this._pageIndex]),this._pageIndex+=1}},e.prototype.hasPrevious=function(){for(;;)if(this._pageCursor){if(this._pageCursor.hasPrevious())return!0;this._pageCursor=void 0}else{if(!(this._pageIndex>0))return this._pageIndex=0,!1;this._pageCursor=this.reversePageCursor(this._pages[this._pageIndex-1]),this._pageIndex-=1}},e.prototype.previousIndex=function(){return this._index-1},e.prototype.previous=function(){for(;;)if(this._pageCursor){if(this._pageCursor.hasPrevious())return this._index-=1,this._pageCursor.previous();this._pageCursor=void 0}else{if(!(this._pageIndex>0))return this._pageIndex=0,{done:!0};this._pageCursor=this.reversePageCursor(this._pages[this._pageIndex-1]),this._pageIndex-=1}},e.prototype.set=function(t){this._pageCursor.set(t)},e.prototype.delete=function(){this._pageCursor.delete()},e}(e.Cursor),p=function(){function t(){}return t.prototype.compare=function(t,r){return e.Objects.compare(t,r)},t.prototype.pageShouldSplit=function(t){return t.arity>this.pageSplitSize},t.prototype.pageShouldMerge=function(t){return t.arity<this.pageSplitSize>>>1},t}();p.prototype.pageSplitSize=32;var u=function(t){function e(r){void 0===r&&(r=e.Page.empty());var o=t.call(this)||this;return o.root=r,o}return o(e,t),Object.defineProperty(e.prototype,"size",{get:function(){return this.root.size},enumerable:!0,configurable:!0}),e.prototype.isEmpty=function(){return this.root.isEmpty()},e.prototype.has=function(t){return this.root.has(t,this)},e.prototype.get=function(t){return this.root.get(t,this)},e.prototype.getEntry=function(t){return this.root.getEntry(t)},e.prototype.firstKey=function(){var t=this.root.firstEntry();return t?t[0]:void 0},e.prototype.firstValue=function(){var t=this.root.firstEntry();return t?t[1]:void 0},e.prototype.firstEntry=function(){return this.root.firstEntry()},e.prototype.lastKey=function(){var t=this.root.lastEntry();return t?t[0]:void 0},e.prototype.lastValue=function(){var t=this.root.lastEntry();return t?t[1]:void 0},e.prototype.lastEntry=function(){return this.root.lastEntry()},e.prototype.nextKey=function(t){var e=this.root.nextEntry(t,this);return e?e[0]:void 0},e.prototype.nextValue=function(t){var e=this.root.nextEntry(t,this);return e?e[1]:void 0},e.prototype.nextEntry=function(t){return this.root.nextEntry(t,this)},e.prototype.previousKey=function(t){var e=this.root.previousEntry(t,this);return e?e[0]:void 0},e.prototype.previousValue=function(t){var e=this.root.previousEntry(t,this);return e?e[1]:void 0},e.prototype.previousEntry=function(t){return this.root.previousEntry(t,this)},e.prototype.set=function(t,e){var r=this.root,o=this.root.updated(t,e,this);return r!==o&&(o.size>r.size&&(o=o.balanced(this)),this.root=o),this},e.prototype.delete=function(t){var e=this.root,r=this.root.removed(t,this);return e!==r&&(this.root=r,!0)},e.prototype.drop=function(t){return t>0&&this.root.size>0&&(t<this.root.size?this.root=this.root.drop(t,this):this.root=e.Page.empty()),this},e.prototype.take=function(t){return t<this.root.size&&this.root.size>0&&(this.root=t>0?this.root.take(t,this):e.Page.empty()),this},e.prototype.clear=function(){this.root=e.Page.empty()},e.prototype.updated=function(t,e){var r=this.root,o=r.updated(t,e,this);return r!==o?(o.size>r.size&&(o=o.balanced(this)),this.copy(o)):this},e.prototype.removed=function(t){var e=this.root,r=e.removed(t,this);return e!==r?this.copy(r):this},e.prototype.cleared=function(){return this.root.isEmpty()?this:this.copy(e.Page.empty())},e.prototype.reduced=function(t,e,r){var o=this.root,i=o.reduced(t,e,r);return o!==i&&(this.root=i),i.fold()},e.prototype.forEach=function(t,e){return this.root.forEach(t,e,this)},e.prototype.keys=function(){return this.root.keys()},e.prototype.values=function(){return this.root.values()},e.prototype.entries=function(){return this.root.entries()},e.prototype.reverseKeys=function(){return this.root.reverseKeys()},e.prototype.reverseValues=function(){return this.root.reverseValues()},e.prototype.reverseEntries=function(){return this.root.reverseEntries()},e.prototype.clone=function(){return this.copy(this.root)},e.prototype.copy=function(t){var r=new e(t);return r.compare!==this.compare&&(r.compare=this.compare),r.pageSplitSize!==this.pageSplitSize&&(r.pageSplitSize=this.pageSplitSize),r},e}(p),h=function(){function t(){}return t.prototype.keys=function(){return new i(this.entries())},t.prototype.values=function(){return new n(this.entries())},t.prototype.reverseKeys=function(){return new i(this.reverseEntries())},t.prototype.reverseValues=function(){return new n(this.reverseEntries())},t.empty=function(){return t._empty||(t._empty=new u.Leaf([],void 0)),t._empty},t}();u.Page=h;var a=function(t){function r(e,r){var o=t.call(this)||this;return o._slots=e,o._fold=r,o}return o(r,t),Object.defineProperty(r.prototype,"arity",{get:function(){return this._slots.length},enumerable:!0,configurable:!0}),Object.defineProperty(r.prototype,"size",{get:function(){return this._slots.length},enumerable:!0,configurable:!0}),r.prototype.isEmpty=function(){return 0===this._slots.length},r.prototype.fold=function(){return this._fold},r.prototype.minKey=function(){return this._slots[0][0]},r.prototype.maxKey=function(){return this._slots[this._slots.length-1][0]},r.prototype.has=function(t,e){return this.lookup(t,e)>=0},r.prototype.get=function(t,e){var r=this.lookup(t,e);return r>=0?this._slots[r][1]:void 0},r.prototype.getEntry=function(t){return this._slots[t]},r.prototype.firstEntry=function(){return this._slots.length?this._slots[0]:void 0},r.prototype.lastEntry=function(){return this._slots.length?this._slots[this._slots.length-1]:void 0},r.prototype.nextEntry=function(t,e){var r=this.lookup(t,e);return r>=0?r+=1:r=-(r+1),this._slots[r]},r.prototype.previousEntry=function(t,e){var r=this.lookup(t,e);return r>=0?r-=1:r=-(r+2),this._slots[r]},r.prototype.updated=function(t,e,r){var o=this.lookup(t,r);return o>=0?this.updatedSlot(o,t,e):(o=-(o+1),this.insertedSlot(o,t,e))},r.prototype.updatedSlot=function(t,e,r){var o=this._slots;if(r!==o[t][1]){var i=o.slice(0);return i[t]=[e,r],this.newLeaf(i,void 0)}return this},r.prototype.insertedSlot=function(t,e,r){for(var o=this._slots,i=o.length+1,n=new Array(i),s=0;s<t;s+=1)n[s]=o[s];n[t]=[e,r];for(s=t;s<i-1;s+=1)n[s+1]=o[s];return this.newLeaf(n,void 0)},r.prototype.removed=function(t,e){var r=this.lookup(t,e);return r>=0?this._slots.length>1?this.removedSlot(r):h.empty():this},r.prototype.removedSlot=function(t){for(var e=this._slots,r=new Array(e.length-1),o=0;o<t;o+=1)r[o]=e[o];for(o=t;o<r.length;o+=1)r[o]=e[o+1];return this.newLeaf(r,void 0)},r.prototype.drop=function(t,e){if(t>0){var r=this._slots;if(t<r.length){for(var o=r.length-t,i=new Array(o),n=0;n<o;n+=1)i[n]=r[n+t];return this.newLeaf(i,void 0)}return h.empty()}return this},r.prototype.take=function(t,e){var r=this._slots;if(t<r.length){if(t>0){for(var o=new Array(t),i=0;i<t;i+=1)o[i]=r[i];return this.newLeaf(o,void 0)}return h.empty()}return this},r.prototype.balanced=function(t){var e=this._slots.length;if(e>1&&t.pageShouldSplit(this)){var r=e>>>1;return this.split(r)}return this},r.prototype.split=function(t){var e=new Array(2),r=this.splitLeft(t),o=this.splitRight(t);e[0]=r,e[1]=o;var i=new Array(1);return i[0]=o.minKey(),this.newNode(e,i,void 0,this._slots.length)},r.prototype.splitLeft=function(t){for(var e=this._slots,r=new Array(t),o=0;o<t;o+=1)r[o]=e[o];return this.newLeaf(r,void 0)},r.prototype.splitRight=function(t){for(var e=this._slots,r=e.length-t,o=new Array(r),i=0;i<r;i+=1)o[i]=e[i+t];return this.newLeaf(o,void 0)},r.prototype.reduced=function(t,e,r){if(void 0===this._fold){for(var o=this._slots,i=t,n=0,s=o.length;n<s;n+=1)i=e(i,o[n][1]);return this.newLeaf(o,i)}return this},r.prototype.forEach=function(t,e,r){for(var o=this._slots,i=0,n=o.length;i<n;i+=1){var s=o[i],p=t.call(e,s[0],s[1],r);if(void 0!==p)return p}},r.prototype.entries=function(){return e.Cursor.array(this._slots)},r.prototype.reverseEntries=function(){return e.Cursor.array(this._slots,this._slots.length)},r.prototype.lookup=function(t,e){for(var r=0,o=this._slots.length-1;r<=o;){var i=r+o>>>1,n=e.compare(t,this._slots[i][0]);if(n>0)r=i+1;else{if(!(n<0))return i;o=i-1}}return-(r+1)},r.prototype.newLeaf=function(t,e){return new r(t,e)},r.prototype.newNode=function(t,e,r,o){return new u.Node(t,e,r,o)},r}(h);u.Leaf=a;var f=function(t){function e(e,r,o,i){var n=t.call(this)||this;return n._pages=e,n._knots=r,n._fold=o,n._size=i,n}return o(e,t),Object.defineProperty(e.prototype,"arity",{get:function(){return this._pages.length},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"size",{get:function(){return this._size},enumerable:!0,configurable:!0}),e.prototype.isEmpty=function(){return 0===this._size},e.prototype.fold=function(){return this._fold},e.prototype.minKey=function(){return this._pages[0].minKey()},e.prototype.maxKey=function(){return this._pages[this._pages.length-1].maxKey()},e.prototype.has=function(t,e){var r=this.lookup(t,e);if(r>0)r+=1;else{if(!(r<0))return!0;r=-(r+1)}return this._pages[r].has(t,e)},e.prototype.get=function(t,e){var r=this.lookup(t,e);return r>=0?r+=1:r=-(r+1),this._pages[r].get(t,e)},e.prototype.getEntry=function(t){for(var e=this._pages,r=0,o=e.length;r<o;r+=1){var i=e[r];if(t<i.size)return i.getEntry(t);t-=i.size}},e.prototype.firstEntry=function(){var t=this._pages;return t.length?t[0].firstEntry():void 0},e.prototype.lastEntry=function(){var t=this._pages;return t.length?t[t.length-1].lastEntry():void 0},e.prototype.nextEntry=function(t,e){var r=this.lookup(t,e);r>=0?r+=1:r=-(r+1);var o=this._pages,i=o[r].nextEntry(t,e);return void 0===i&&r+1<o.length&&(i=o[r+1].nextEntry(t,e)),i},e.prototype.previousEntry=function(t,e){var r=this.lookup(t,e);r>=0?r+=1:r=-(r+1);var o=this._pages,i=o[r].previousEntry(t,e);return void 0===i&&r>0&&(i=o[r-1].previousEntry(t,e)),i},e.prototype.updated=function(t,e,r){var o=this.lookup(t,r);o>=0?o+=1:o=-(o+1);var i=this._pages[o],n=i.updated(t,e,r);return i!==n?i.size!==n.size&&r.pageShouldSplit(n)?this.updatedPageSplit(o,n,i):this.updatedPage(o,n,i):this},e.prototype.updatedPage=function(t,e,r){var o=this._pages.slice(0);o[t]=e;var i,n=this._knots;n.length>0?(i=n.slice(0),t>0&&(i[t-1]=e.minKey())):i=[];var s=this._size-r.size+e.size;return this.newNode(o,i,void 0,s)},e.prototype.updatedPageSplit=function(t,e,r){for(var o=this._pages,i=new Array(o.length+1),n=0;n<t;n+=1)i[n]=o[n];var s=e.splitLeft(e.arity>>>1),p=e.splitRight(e.arity>>>1);i[t]=s,i[t+1]=p;for(n=t+1;n<o.length;n+=1)i[n+1]=o[n];var u=this._knots,h=new Array(o.length);if(t>0){for(n=0;n<t-1;n+=1)h[n]=u[n];h[t-1]=s.minKey(),h[t]=p.minKey();for(n=t;n<u.length;n+=1)h[n+1]=u[n]}else{h[0]=p.minKey();for(n=0;n<u.length;n+=1)h[n+1]=u[n]}var a=this._size-r.size+e.size;return this.newNode(i,h,void 0,a)},e.prototype.updatedPageMerge=function(t,e,r){for(var o=this._pages,i=e._pages,n=new Array(o.length+i.length-1),s=0;s<t;s+=1)n[s]=o[s];for(s=0;s<i.length;s+=1)n[s+t]=i[s];for(s=t+1;s<o.length;s+=1)n[s+i.length-1]=o[s];var p=this._knots,u=e._knots,h=new Array(n.length-1);if(t>0){for(s=0;s<t-1;s+=1)h[s]=p[s];h[t-1]=i[0].minKey();for(s=0;s<u.length;s+=1)h[s+t]=u[s];for(s=t;s<p.length;s+=1)h[s+u.length]=p[s]}else{for(s=0;s<u.length;s+=1)h[s]=u[s];h[u.length]=o[1].minKey();for(s=1;s<p.length;s+=1)h[s+u.length]=p[s]}var a=this._size-r.size+e.size;return this.newNode(n,h,void 0,a)},e.prototype.removed=function(t,e){var r=this.lookup(t,e);r>=0?r+=1:r=-(r+1);var o=this._pages[r],i=o.removed(t,e);return o!==i?this.replacedPage(r,i,o,e):this},e.prototype.replacedPage=function(t,r,o,i){return r.isEmpty()?this._pages.length>2?this.removedPage(t,r,o):this._pages.length>1?0===t?this._pages[1]:this._pages[0]:h.empty():r instanceof e&&i.pageShouldMerge(r)?this.updatedPageMerge(t,r,o):this.updatedPage(t,r,o)},e.prototype.removedPage=function(t,e,r){for(var o=this._pages,i=new Array(o.length-1),n=0;n<t;n+=1)i[n]=o[n];for(n=t+1;n<o.length;n+=1)i[n-1]=o[n];var s=this._knots,p=new Array(s.length-1);if(t>0){for(n=0;n<t-1;n+=1)p[n]=s[n];for(n=t;n<s.length;n+=1)p[n-1]=s[n]}else for(n=1;n<s.length;n+=1)p[n-1]=s[n];var u=this._size-r.size;return this.newNode(i,p,void 0,u)},e.prototype.drop=function(t,e){if(t>0){var r=this._size;if(t<r){for(var o=this._pages,i=0;i<o.length;){var n=o[i].size;if(!(n<=t))break;r-=n,t-=n,i+=1}var s=o.length-i;if(s>1){var p=void 0;if(i>0){for(var u=new Array(s),a=0;a<s;a+=1)u[a]=o[a+i];var f=new Array(s-1);for(a=0;a<f.length;a+=1)f[a]=this._knots[a+i];p=this.newNode(u,f,void 0,r)}else p=this;if(t>0){var l=o[i],g=l.drop(t,e);return p.replacedPage(0,g,l,e)}return p}return o[i].drop(t,e)}return h.empty()}return this},e.prototype.take=function(t,e){if(t<this._size){if(t>0){for(var r=this._pages,o=0,i=0;o<r.length&&t>0;){var n=r[o].size;if(i+=n,o+=1,!(n<=t))break;t-=n}var s=0===t?o:o+1;if(s>1){var p=void 0;if(o<r.length){for(var u=new Array(s),a=0;a<s;a+=1)u[a]=r[a];var f=new Array(s-1);for(a=0;a<f.length;a+=1)f[a]=this._knots[a];p=this.newNode(u,f,void 0,i)}else p=this;if(t>0){var l=r[o-1],g=l.take(t,e);return p.replacedPage(o-1,g,l,e)}return p}return t>0?r[0].take(t,e):r[0]}return h.empty()}return this},e.prototype.balanced=function(t){if(this._pages.length>1&&t.pageShouldSplit(this)){var e=this._knots.length>>>1;return this.split(e)}return this},e.prototype.split=function(t){var e=new Array(2),r=this.splitLeft(t),o=this.splitRight(t);e[0]=r,e[1]=o;var i=new Array(1);return i[0]=o.minKey(),this.newNode(e,i,void 0,this._size)},e.prototype.splitLeft=function(t){for(var e=this._pages,r=new Array(t+1),o=0;o<t+1;o+=1)r[o]=e[o];var i=this._knots,n=new Array(t);for(o=0;o<t;o+=1)n[o]=i[o];var s=0;for(o=0;o<=t;o+=1)s+=r[o].size;return this.newNode(r,n,void 0,s)},e.prototype.splitRight=function(t){for(var e=this._pages,r=e.length-(t+1),o=new Array(r),i=0;i<r;i+=1)o[i]=e[i+(t+1)];var n=this._knots,s=new Array(r-1);for(i=0;i<s.length;i+=1)s[i]=n[i+(t+1)];var p=0;for(i=0;i<r;i+=1)p+=o[i].size;return this.newNode(o,s,void 0,p)},e.prototype.reduced=function(t,e,r){if(void 0===this._fold){for(var o=this._pages,i=o.length,n=new Array(i),s=0;s<i;s+=1)n[s]=o[s].reduced(t,e,r);var p=n[0].fold();for(s=1;s<i;s+=1)p=r(p,n[s].fold());return this.newNode(n,this._knots,p,this._size)}return this},e.prototype.forEach=function(t,e,r){for(var o=this._pages,i=0,n=o.length;i<n;i+=1){var s=o[i].forEach(t,e,r);if(void 0!==s)return s}},e.prototype.entries=function(){return new u.NodeCursor(this._pages)},e.prototype.reverseEntries=function(){return new u.NodeCursor(this._pages,this._size,this._pages.length)},e.prototype.lookup=function(t,e){for(var r=0,o=this._knots.length-1;r<=o;){var i=r+o>>>1,n=e.compare(t,this._knots[i]);if(n>0)r=i+1;else{if(!(n<0))return i;o=i-1}}return-(r+1)},e.prototype.newNode=function(t,r,o,i){return new e(t,r,o,i)},e}(h);u.Node=f;var l=function(t){function e(e,r,o,i){return t.call(this,e,r,o,i)||this}return o(e,t),e.prototype.pageSize=function(t){return t.size},e.prototype.pageCursor=function(t){return t.entries()},e.prototype.reversePageCursor=function(t){return t.reverseEntries()},e}(s);u.NodeCursor=l;var g=function(){function t(){}return t.prototype.identify=function(t){var r=new Uint8Array(6);return e.Random.fillBytes(r),r},t.prototype.compare=function(t,r){return e.Objects.compare(t,r)},t.prototype.pageShouldSplit=function(t){return t.arity>this.pageSplitSize},t.prototype.pageShouldMerge=function(t){return t.arity<this.pageSplitSize>>>1},t}();g.prototype.pageSplitSize=32;var y=function(t){function e(r){void 0===r&&(r=e.Page.empty());var o=t.call(this)||this;return o.root=r,o}return o(e,t),Object.defineProperty(e.prototype,"length",{get:function(){return this.root.size},enumerable:!0,configurable:!0}),e.prototype.isEmpty=function(){return this.root.isEmpty()},e.prototype.get=function(t,e){if(!(void 0!==e&&(t=this.lookup(e,t))<0))return this.root.get(t)},e.prototype.getEntry=function(t,e){if(!(void 0!==e&&(t=this.lookup(e,t))<0))return this.root.getEntry(t)},e.prototype.set=function(t,e,r){if(void 0!==r&&(t=this.lookup(r,t))<0)throw new RangeError(""+r);var o=this.root;if(t<0||t>=o.size)throw new RangeError(""+t);return this.root=o.updated(t,e,this),this},e.prototype.insert=function(t,e,r){var o=this.root;if(t<0||t>o.size)throw new RangeError(""+t);return this.root=o.inserted(t,e,r,this).balanced(this),this},e.prototype.remove=function(t,e){if(void 0!==e&&(t=this.lookup(e,t))<0)throw new RangeError(""+e);var r=this.root;if(t<0||t>r.size)throw new RangeError(""+t);return this.root=r.removed(t,this),this},e.prototype.push=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];for(var r=this.root,o=0;o<t.length;o+=1)r=r.inserted(r.size,t[o],void 0,this).balanced(this);return this.root=r,r.size},e.prototype.pop=function(){var t=this.root,e=t.size-1;if(e>=0){var r=t.get(e);return this.root=t.removed(e,this),r}},e.prototype.unshift=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];for(var r=this.root,o=t.length-1;o>=0;o-=1)r=r.inserted(0,t[o],void 0,this).balanced(this);return this.root=r,r.size},e.prototype.shift=function(){var t=this.root;if(t.size>0){var e=t.get(0);return this.root=t.removed(0,this),e}},e.prototype.move=function(t,e,r){if(void 0!==r&&(t=this.lookup(r,t))<0)throw new RangeError(""+r);var o=this.root;if(t<0||t>=o.size)throw new RangeError(""+t);if(e<0||e>=o.size)throw new RangeError(""+e);if(t!==e){var i=o.getEntry(t);this.root=o.removed(t,this).inserted(e,i[1],i[0],this).balanced(this)}return this},e.prototype.splice=function(t,e){for(var r=[],o=2;o<arguments.length;o++)r[o-2]=arguments[o];var i=this.root;t<0&&(t=i.size+t),t=Math.min(Math.max(0,t),i.size),void 0===e&&(e=i.size-t);for(var n=[],s=t,p=t+e;s<p;s+=1)n.push(i.get(t)),i=i.removed(t,this);for(s=0;s<r.length;s+=1)i=i.inserted(t+s,r[s],void 0,this).balanced(this);return this.root=i,n},e.prototype.drop=function(t){var r=this.root;return t>0&&r.size>0&&(t<r.size?this.root=r.drop(t,this):this.root=e.Page.empty()),this},e.prototype.take=function(t){var r=this.root;return t<r.size&&r.size>0&&(this.root=t>0?r.take(t,this):e.Page.empty()),this},e.prototype.clear=function(){this.root=e.Page.empty()},e.prototype.forEach=function(t,e){return this.root.forEach(t,e,0,this)},e.prototype.keys=function(){return this.root.keys()},e.prototype.values=function(){return this.root.values()},e.prototype.entries=function(){return this.root.entries()},e.prototype.reverseKeys=function(){return this.root.reverseKeys()},e.prototype.reverseValues=function(){return this.root.reverseValues()},e.prototype.reverseEntries=function(){return this.root.reverseEntries()},e.prototype.clone=function(){return this.copy(this.root)},e.prototype.copy=function(t){var r=new e(t);return r.identify!==this.identify&&(r.identify=this.identify),r.compare!==this.compare&&(r.compare=this.compare),r.pageSplitSize!==this.pageSplitSize&&(r.pageSplitSize=this.pageSplitSize),r},e.prototype.lookup=function(t,e){void 0===e&&(e=0);var r=this.root,o=e=Math.min(Math.max(0,e),r.size-1);do{var i=r.getEntry(o);if(i&&0===this.compare(i[0],t))return o;o=(o+1)%r.size}while(isFinite(o)&&o!==e);return-1},e}(g);y.prototype.pageSplitSize=32;var c=function(){function t(){}return t.prototype.keys=function(){return new i(this.entries())},t.prototype.values=function(){return new n(this.entries())},t.prototype.reverseKeys=function(){return new i(this.reverseEntries())},t.prototype.reverseValues=function(){return new n(this.reverseEntries())},t.empty=function(){return t._empty||(t._empty=new y.Leaf([])),t._empty},t}();y.Page=c;var v=function(t){function r(e){var r=t.call(this)||this;return r._slots=e,r}return o(r,t),Object.defineProperty(r.prototype,"arity",{get:function(){return this._slots.length},enumerable:!0,configurable:!0}),Object.defineProperty(r.prototype,"size",{get:function(){return this._slots.length},enumerable:!0,configurable:!0}),r.prototype.isEmpty=function(){return 0===this._slots.length},r.prototype.get=function(t){var e=this._slots[t];return e?e[1]:void 0},r.prototype.getEntry=function(t){return this._slots[t]},r.prototype.updated=function(t,e,r){if(t<0||t>=this._slots.length)throw new RangeError(""+t);return this.updatedItem(t,e)},r.prototype.updatedItem=function(t,e){var o=this._slots,i=o[t];if(e!==i[1]){var n=o.slice(0);return n[t]=[i[0],e],new r(n)}return this},r.prototype.inserted=function(t,e,r,o){if(t<0||t>this._slots.length)throw new RangeError(""+t);return this.insertedItem(t,e,r,o)},r.prototype.insertedItem=function(t,e,o,i){void 0===o&&(o=i.identify(e));for(var n=this._slots,s=new Array(n.length+1),p=0;p<t;p+=1)s[p]=n[p];s[t]=[o,e];for(p=t;p<n.length;p+=1)s[p+1]=n[p];return new r(s)},r.prototype.removed=function(t,e){if(t<0||t>=this._slots.length)throw new RangeError(""+t);return this._slots.length>1?this.removedSlot(t):c.empty()},r.prototype.removedSlot=function(t){for(var e=this._slots,o=new Array(e.length-1),i=0;i<t;i+=1)o[i]=e[i];for(i=t;i<o.length;i+=1)o[i]=e[i+1];return new r(o)},r.prototype.drop=function(t,e){var o=this._slots;if(t>0&&o.length>0){if(t<o.length){for(var i=o.length-t,n=new Array(i),s=0;s<i;s+=1)n[s]=o[s+t];return new r(n)}return c.empty()}return this},r.prototype.take=function(t,e){var o=this._slots;if(t<o.length&&o.length>0){if(t>0){for(var i=new Array(t),n=0;n<t;n+=1)i[n]=o[n];return new r(i)}return c.empty()}return this},r.prototype.balanced=function(t){var e=this._slots.length;return e>1&&t.pageShouldSplit(this)?this.split(e>>>1):this},r.prototype.split=function(t){var e=new Array(2),r=this.splitLeft(t),o=this.splitRight(t);e[0]=r,e[1]=o;var i=new Array(1);return i[0]=t,new y.Node(e,i,this._slots.length)},r.prototype.splitLeft=function(t){for(var e=this._slots,o=new Array(t),i=0;i<t;i+=1)o[i]=e[i];return new r(o)},r.prototype.splitRight=function(t){for(var e=this._slots,o=e.length-t,i=new Array(o),n=0;n<o;n+=1)i[n]=e[n+t];return new r(i)},r.prototype.forEach=function(t,e,r,o){for(var i=0;i<this._slots.length;i+=1){var n=this._slots[i],s=t.call(e,n[1],r+i,o,n[0]);if(void 0!==s)return s}},r.prototype.entries=function(){return e.Cursor.array(this._slots)},r.prototype.reverseEntries=function(){return e.Cursor.array(this._slots,this._slots.length)},r}(c);y.Leaf=v;var d=function(t){function e(e,r,o){var i=t.call(this)||this;if(i._pages=e,void 0===r||void 0===o){o=0;for(var n=0,s=(r=new Array(e.length-1)).length;n<s;n+=1)o+=e[n].size,r[n]=o;o+=e[r.length].size}return i._knots=r,i._size=o,i}return o(e,t),Object.defineProperty(e.prototype,"arity",{get:function(){return this._pages.length},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"size",{get:function(){return this._size},enumerable:!0,configurable:!0}),e.prototype.isEmpty=function(){return 0===this._size},e.prototype.get=function(t){var e=this.lookup(t);e>=0?e+=1:e=-(e+1);var r=0===e?t:t-this._knots[e-1];return this._pages[e].get(r)},e.prototype.getEntry=function(t){var e=this.lookup(t);e>=0?e+=1:e=-(e+1);var r=0===e?t:t-this._knots[e-1];return this._pages[e].getEntry(r)},e.prototype.updated=function(t,e,r){var o=this.lookup(t);o>=0?o+=1:o=-(o+1);var i=0===o?t:t-this._knots[o-1],n=this._pages[o],s=n.updated(i,e,r);return n!==s?n.size!==s.size&&r.pageShouldSplit(s)?this.updatedPageSplit(o,s,n):this.updatedPage(o,s,n):this},e.prototype.updatedPage=function(t,r,o){var i=this._pages,n=i.slice(0);n[t]=r;var s,p,u=this._knots;if(i.length-1>0){s=u.slice(0),p=t>0?u[t-1]:0;for(var h=t;h<s.length;h+=1)p+=n[h].size,s[h]=p;p+=n[s.length].size}else s=[],p=0;return new e(n,s,p)},e.prototype.updatedPageSplit=function(t,r,o){for(var i=this._pages,n=new Array(i.length+1),s=0;s<t;s+=1)n[s]=i[s];var p=r.splitLeft(r.arity>>>1),u=r.splitRight(r.arity>>>1);n[t]=p,n[t+1]=u;for(s=t+1;s<i.length;s+=1)n[s+1]=i[s];return new e(n)},e.prototype.updatedPageMerge=function(t,r,o){for(var i=this._pages,n=r._pages,s=new Array(i.length+n.length-1),p=0;p<t;p+=1)s[p]=i[p];for(p=0;p<n.length;p+=1)s[p+t]=n[p];for(p=t+1;p<i.length;p+=1)s[p+n.length-1]=i[p];return new e(s)},e.prototype.inserted=function(t,e,r,o){var i=this.lookup(t);i>=0?i+=1:i=-(i+1);var n=0===i?t:t-this._knots[i-1],s=this._pages[i],p=s.inserted(n,e,r,o);return s!==p?o.pageShouldSplit(p)?this.updatedPageSplit(i,p,s):this.updatedPage(i,p,s):this},e.prototype.removed=function(t,e){var r=this.lookup(t);r>=0?r+=1:r=-(r+1);var o=0===r?t:t-this._knots[r-1],i=this._pages[r],n=i.removed(o,e);return i!==n?this.replacedPage(r,n,i,e):this},e.prototype.replacedPage=function(t,r,o,i){return r.isEmpty()?this._pages.length>2?this.removedPage(t,r,o):this._pages.length>1?0===t?this._pages[1]:this._pages[0]:c.empty():r instanceof e&&i.pageShouldMerge(r)?this.updatedPageMerge(t,r,o):this.updatedPage(t,r,o)},e.prototype.removedPage=function(t,r,o){for(var i=this._pages,n=new Array(i.length-1),s=0;s<t;s+=1)n[s]=i[s];for(s=t+1;s<i.length;s+=1)n[s-1]=i[s];var p,u=this._knots,h=new Array(u.length-1);if(t>0){for(s=0;s<t;s+=1)h[s]=u[s];p=u[t-1]}else p=0;for(s=t;s<h.length;s+=1)p+=n[s].size,h[s]=p;return new e(n,h,p+=n[h.length].size)},e.prototype.drop=function(t,r){if(t>0){if(t<this._size){var o=this.lookup(t);o>=0?o+=1:o=-(o+1),t=0===o?t:t-this._knots[o-1];var i=this._pages,n=i.length-o;if(n>1){var s=void 0;if(o>0){for(var p=new Array(n),u=0;u<n;u+=1)p[u]=i[u+o];s=new e(p)}else s=this;if(t>0){var h=i[o],a=h.drop(t,r);return s.replacedPage(0,a,h,r)}return s}return i[o].drop(t,r)}return c.empty()}return this},e.prototype.take=function(t,r){if(t<this._size){if(t>0){var o=this.lookup(t);o>=0?o+=1:o=-(o+1),t=0===o?t:t-this._knots[o-1];var i=this._pages,n=0===t?o:o+1;if(n>1){var s=void 0;if(o<i.length){for(var p=new Array(n),u=0;u<n;u+=1)p[u]=i[u];var h=new Array(n-1);for(u=0;u<h.length;u+=1)h[u]=this._knots[u];s=new e(p,h,h[n-2]+p[n-1].size)}else s=this;if(t>0){var a=i[o],f=a.take(t,r);return s.replacedPage(o,f,a,r)}return s}return t>0?i[0].take(t,r):i[0]}return c.empty()}return this},e.prototype.balanced=function(t){if(this._pages.length>1&&t.pageShouldSplit(this)){var e=this._knots.length>>>1;return this.split(e)}return this},e.prototype.split=function(t){var r=new Array(2),o=this.splitLeft(t),i=this.splitRight(t);r[0]=o,r[1]=i;var n=new Array(1);return n[0]=o._size,new e(r,n,this._size)},e.prototype.splitLeft=function(t){for(var r=this._pages,o=new Array(t+1),i=0;i<t+1;i+=1)o[i]=r[i];var n=this._knots,s=new Array(t);for(i=0;i<t;i+=1)s[i]=n[i];var p=0;for(i=0;i<=t;i+=1)p+=o[i].size;return new e(o,s,p)},e.prototype.splitRight=function(t){for(var r=this._pages,o=r.length-(t+1),i=new Array(o),n=0;n<o;n+=1)i[n]=r[n+(t+1)];var s,p=new Array(o-1);if(o>0){s=i[0].size;for(n=1;n<o;n+=1)p[n-1]=s,s+=i[n].size}else s=0;return new e(i,p,s)},e.prototype.forEach=function(t,e,r,o){for(var i=0;i<this._pages.length;i+=1){var n=this._pages[i],s=n.forEach(t,e,r,o);if(void 0!==s)return s;r+=n.size}},e.prototype.entries=function(){return new y.NodeCursor(this._pages)},e.prototype.reverseEntries=function(){return new y.NodeCursor(this._pages,this._size,this._pages.length)},e.prototype.lookup=function(t){for(var e=0,r=this._knots.length-1;e<=r;){var o=e+r>>>1;if(t>this._knots[o])e=o+1;else{if(!(t<this._knots[o]))return o;r=o-1}}return-(e+1)},e}(c);y.Node=d;var _=function(t){function e(e,r,o,i){return t.call(this,e,r,o,i)||this}return o(e,t),e.prototype.pageSize=function(t){return t.size},e.prototype.pageCursor=function(t){return t.entries()},e.prototype.reversePageCursor=function(t){return t.reverseEntries()},e}(s);y.NodeCursor=_,t.BTree=u,t.BTreeContext=p,t.BTreeLeaf=a,t.BTreeNode=f,t.BTreeNodeCursor=l,t.BTreePage=h,t.KeysCursor=i,t.NodeCursor=s,t.STree=y,t.STreeContext=g,t.STreeLeaf=v,t.STreeNode=d,t.STreeNodeCursor=_,t.STreePage=c,t.ValuesCursor=n,Object.defineProperty(t,"__esModule",{value:!0})}));
//# sourceMappingURL=swim-collections.min.js.map